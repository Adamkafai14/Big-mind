<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Big Mind</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'fun-blue': '#3B82F6',
                        'fun-yellow': '#F59E0B',
                        'fun-green': '#10B981',
                        'fun-orange': '#F97316',
                        'fun-purple': '#8B5CF6',
                        'fun-pink': '#EC4899'
                    },
                    fontFamily: {
                        'comic': ['Comic Neue', 'cursive'],
                        'poppins': ['Poppins', 'sans-serif']
                    },
                    animation: {
                        'bounce-slow': 'bounce 2s infinite',
                        'pulse-slow': 'pulse 3s infinite'
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@300;400;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Enhanced Animations */
        @keyframes wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-3deg); }
            75% { transform: rotate(3deg); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
        }
        
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }
        
        @keyframes slideInFromLeft {
            0% { transform: translateX(-100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInFromRight {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideInFromBottom {
            0% { transform: translateY(100%); opacity: 0; }
            100% { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        @keyframes xpGlow {
            0% { box-shadow: 0 0 5px #3B82F6; }
            50% { box-shadow: 0 0 20px #3B82F6, 0 0 30px #3B82F6; }
            100% { box-shadow: 0 0 5px #3B82F6; }
        }
        
        /* Interactive Elements */
        .hover-bounce:hover {
            animation: bounce 0.5s;
        }
        
        #xpDisplay {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #xpDisplay:hover {
            transform: scale(1.05);
            animation: xpGlow 1s ease-in-out;
        }
        
        #coinCounter {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .hover-zoom {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .hover-zoom:hover {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .hover-wiggle:hover {
            animation: wiggle 0.5s ease-in-out;
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        .pulse-glow {
            animation: pulse-glow 2s infinite;
        }
        
        /* Card Enhancements */
        .card-shadow {
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .card-shadow:hover {
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        /* Gradient Backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            border-radius: 4px;
            transition: width 1s ease-in-out;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        /* Coin Animation */
        .coin-spin {
            transition: transform 0.6s ease;
        }
        
        .coin-spin:hover {
            transform: rotateY(360deg);
        }
        
        /* Loading Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f4f6;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Sparkle Effects */
        .sparkle {
            position: relative;
        }
        
        .sparkle::before,
        .sparkle::after {
            content: '✨';
            position: absolute;
            opacity: 0;
            animation: sparkle 2s infinite;
        }
        
        .sparkle::before {
            top: -10px;
            right: -10px;
            animation-delay: 0.5s;
        }
        
        .sparkle::after {
            bottom: -10px;
            left: -10px;
            animation-delay: 1s;
        }
        
        /* Slide Animations */
        .slide-in-left {
            animation: slideInFromLeft 0.8s ease-out;
        }
        
        .slide-in-right {
            animation: slideInFromRight 0.8s ease-out;
        }
        
        .slide-in-bottom {
            animation: slideInFromBottom 0.8s ease-out;
        }
        
        /* Button Effects */
        .btn-bounce {
            transition: all 0.2s ease;
        }
        
        .btn-bounce:hover {
            transform: translateY(-2px);
        }
        
        .btn-bounce:active {
            transform: translateY(0px);
        }
        
        /* Star Rating */
        .star-rating .star {
            transition: all 0.2s ease;
        }
        
        .star-rating:hover .star {
            transform: scale(1.1);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            animation: slideInFromBottom 0.3s ease;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #10b981, #34d399);
            color: white;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 font-poppins min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16 mobile-header">
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold text-fun-blue font-comic">
                            <i class="fas fa-graduation-cap mr-2"></i>
                            Big Mind
                        </h1>
                    </div>
                </div>

                <!-- Navigation -->
                <nav class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#" class="text-fun-blue hover:text-fun-purple px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200">
                            <i class="fas fa-home mr-1"></i> Accueil
                        </a>
                        <a href="#" onclick="openShop()" class="text-gray-600 hover:text-fun-orange px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200">
                            <i class="fas fa-store mr-1"></i> Boutique
                        </a>
                        <a href="#" onclick="openInventory()" class="text-gray-600 hover:text-fun-purple px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200">
                            <i class="fas fa-backpack mr-1"></i> Inventaire
                        </a>
                        <a href="#" onclick="openQuests()" class="text-gray-600 hover:text-fun-blue px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200">
                            <i class="fas fa-scroll mr-1"></i> Quêtes
                        </a>
                        <a href="#" onclick="openProfileSetup()" class="text-gray-600 hover:text-fun-green px-3 py-2 rounded-md text-sm font-medium transition-colors duration-200">
                            <i class="fas fa-user mr-1"></i> Mon Profil
                        </a>
                    </div>
                </nav>

                <!-- Coin Counter et Menu Mobile -->
                <div class="flex items-center">
                    <div class="bg-fun-yellow text-white px-3 py-2 rounded-full flex items-center hover-bounce mr-3">
                        <i class="fas fa-coins mr-2 text-lg"></i>
                        <span class="font-bold" id="coinCounter">0</span>
                    </div>
                    <div class="bg-blue-500 text-white px-3 py-2 rounded-full flex items-center hover-bounce">
                        <span class="font-bold" id="xpDisplay">⭐0 🏆1</span>
                    </div>
                    
                    <!-- Bouton hamburger mobile -->
                    <button class="md:hidden ml-4 p-2 text-gray-600 hover:text-gray-900 focus:outline-none" onclick="toggleMobileMenu()" id="mobileMenuBtn">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="hamburgerIcon">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                        <svg class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="closeIcon">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu mobile plein écran -->
        <div id="mobileMenuOverlay" class="md:hidden fixed inset-0 bg-gradient-to-br from-fun-blue to-fun-purple bg-opacity-95 backdrop-blur-sm z-50 transform -translate-x-full transition-transform duration-300">
            <div class="flex flex-col h-full">
                <!-- Header du menu -->
                <div class="flex items-center justify-between p-6 border-b border-white border-opacity-20">
                    <h2 class="text-2xl font-bold text-white">🧠 Big Mind</h2>
                    <button onclick="toggleMobileMenu()" class="text-white p-2 hover:bg-white hover:bg-opacity-20 rounded-full transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- Stats utilisateur -->
                <div class="p-6 text-center border-b border-white border-opacity-20">
                    <div class="text-white mb-4">
                        <div class="text-4xl mb-2">🎓</div>
                        <p class="text-xl font-semibold" id="mobileUserName">Visiteur</p>
                        <div class="flex justify-center gap-4 mt-3">
                            <div class="bg-white bg-opacity-20 rounded-full px-4 py-2">
                                <span class="text-yellow-300">💰</span>
                                <span class="font-bold ml-1" id="mobileCoinCount">0</span>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-full px-4 py-2">
                                <span class="text-blue-200" id="mobileXpCount">⭐0 🏆1</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Menu navigation -->
                <div class="flex-1 px-6 py-8">
                    <nav class="space-y-4">
                        <a href="#" onclick="toggleMobileMenu()" class="mobile-menu-item">
                            <i class="fas fa-home text-xl"></i>
                            <span>Accueil</span>
                            <i class="fas fa-chevron-right text-sm opacity-50"></i>
                        </a>
                        <a href="#" onclick="openShop(); toggleMobileMenu();" class="mobile-menu-item">
                            <i class="fas fa-store text-xl"></i>
                            <span>Boutique</span>
                            <i class="fas fa-chevron-right text-sm opacity-50"></i>
                        </a>
                        <a href="#" onclick="openInventory(); toggleMobileMenu();" class="mobile-menu-item">
                            <i class="fas fa-backpack text-xl"></i>
                            <span>Inventaire</span>
                            <i class="fas fa-chevron-right text-sm opacity-50"></i>
                        </a>
                        <a href="#" onclick="openQuests(); toggleMobileMenu();" class="mobile-menu-item">
                            <i class="fas fa-scroll text-xl"></i>
                            <span>Quêtes</span>
                            <i class="fas fa-chevron-right text-sm opacity-50"></i>
                        </a>
                        <a href="#" onclick="openProfileSetup(); toggleMobileMenu();" class="mobile-menu-item">
                            <i class="fas fa-user text-xl"></i>
                            <span>Mon Profil</span>
                            <i class="fas fa-chevron-right text-sm opacity-50"></i>
                        </a>
                    </nav>
                </div>
                
                <!-- Footer du menu -->
                <div class="p-6 border-t border-white border-opacity-20">
                    <p class="text-white text-center opacity-70 text-sm">
                        🎉 Continue ton aventure d'apprentissage !
                    </p>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Section -->
        <section class="text-center mb-12">
            <div class="bg-white rounded-3xl shadow-xl p-8 mb-8">
                <div class="flex items-center justify-center mb-6">
                    <!-- Character Avatar Placeholder -->
                    <div id="characterAvatar" class="w-24 h-24 bg-gradient-to-br from-fun-blue to-fun-purple rounded-full flex items-center justify-center text-white text-4xl animate-bounce-slow">
                        <i class="fas fa-robot"></i>
                    </div>
                </div>
                <h2 class="text-3xl font-bold text-gray-800 mb-4 font-comic">
                    Bonjour <span class="text-fun-blue" id="studentName">Visiteur</span> !
                </h2>
                <p class="text-xl text-gray-600 mb-6">
                    Prêt(e) à apprendre en t'amusant aujourd'hui ?
                </p>

                <!-- Class Selection -->
                <div class="mb-6 text-center">
                    <h3 class="text-lg font-bold mb-4">📚 Choisis ta classe :</h3>
                    <div class="flex flex-wrap justify-center gap-3 max-w-2xl mx-auto">
                        <button class="class-btn bg-blue-100 hover:bg-blue-200 text-blue-800 px-6 py-3 rounded-lg font-bold transition-colors btn-bounce" onclick="selectClass('cp')" data-class="cp">
                            CP
                        </button>
                        <button class="class-btn bg-gray-100 hover:bg-gray-200 text-gray-600 px-6 py-3 rounded-lg font-bold transition-colors btn-bounce" onclick="selectClass('ce1')" data-class="ce1">
                            CE1
                        </button>
                        <button class="class-btn bg-gray-100 hover:bg-gray-200 text-gray-600 px-6 py-3 rounded-lg font-bold transition-colors btn-bounce" onclick="selectClass('ce2')" data-class="ce2">
                            CE2
                        </button>
                        <button class="class-btn bg-gray-100 hover:bg-gray-200 text-gray-600 px-6 py-3 rounded-lg font-bold transition-colors btn-bounce" onclick="selectClass('cm1')" data-class="cm1">
                            CM1
                        </button>
                        <button class="class-btn bg-gray-100 hover:bg-gray-200 text-gray-600 px-6 py-3 rounded-lg font-bold transition-colors btn-bounce" onclick="selectClass('cm2')" data-class="cm2">
                            CM2
                        </button>
                    </div>
                    <p class="text-sm text-gray-500 mt-4">Classe sélectionnée : <span id="selectedClass" class="font-bold text-blue-600">CP</span></p>
                </div>
                
            </div>
        </section>

        <!-- Subjects Grid -->
        <section class="mb-12">
            <h3 class="text-2xl font-bold text-center text-gray-800 mb-8 font-comic">
                Choisis ta matière préférée !
            </h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Math Card -->
                <div class="bg-white rounded-2xl card-shadow p-6 hover-zoom cursor-pointer transition-all duration-300 border-l-4 border-fun-blue">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-fun-blue rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-calculator text-white text-2xl"></i>
                        </div>
                        <h4 class="text-xl font-bold text-gray-800 mb-2">Mathématiques</h4>
                        <p class="text-gray-600 mb-4">Nombres, calculs et géométrie</p>
                        <div class="text-center">
                            <p class="text-sm text-gray-600 mb-2">Progrès: <span id="math-progress">0</span>%</p>
                            <div class="progress-bar mx-auto" style="width: 120px;">
                                <div class="progress-fill" id="math-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- French Card -->
                <div class="bg-white rounded-2xl card-shadow p-6 hover-zoom cursor-pointer transition-all duration-300 border-l-4 border-fun-green">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-fun-green rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-book-open text-white text-2xl"></i>
                        </div>
                        <h4 class="text-xl font-bold text-gray-800 mb-2">Français</h4>
                        <p class="text-gray-600 mb-4">Lecture, écriture et grammaire</p>
                        <div class="text-center">
                            <p class="text-sm text-gray-600 mb-2">Progrès: <span id="french-progress">0</span>%</p>
                            <div class="progress-bar mx-auto" style="width: 120px;">
                                <div class="progress-fill" id="french-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Science Card -->
                <div class="bg-white rounded-2xl card-shadow p-6 hover-zoom cursor-pointer transition-all duration-300 border-l-4 border-fun-purple">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-fun-purple rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-atom text-white text-2xl"></i>
                        </div>
                        <h4 class="text-xl font-bold text-gray-800 mb-2">Sciences</h4>
                        <p class="text-gray-600 mb-4">Expériences et découvertes</p>
                        <div class="text-center">
                            <p class="text-sm text-gray-600 mb-2">Progrès: <span id="science-progress">0</span>%</p>
                            <div class="progress-bar mx-auto" style="width: 120px;">
                                <div class="progress-fill" id="science-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>


                <!-- History & Geography Card -->
                <div class="bg-white rounded-2xl card-shadow p-6 hover-zoom cursor-pointer transition-all duration-300 border-l-4 border-fun-orange">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-fun-orange rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-globe-europe text-white text-2xl"></i>
                        </div>
                        <h4 class="text-xl font-bold text-gray-800 mb-2">Histoire & Géographie</h4>
                        <p class="text-gray-600 mb-4">Passé et monde actuel</p>
                        <div class="text-center">
                            <p class="text-sm text-gray-600 mb-2">Progrès: <span id="histgeo-progress">0</span>%</p>
                            <div class="progress-bar mx-auto" style="width: 120px;">
                                <div class="progress-fill" id="histgeo-progress-bar" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Daily Bonus Section -->
        <section class="text-center">
            <div class="bg-gradient-to-r from-fun-yellow to-fun-orange rounded-2xl shadow-xl p-6 text-white">
                <h3 class="text-2xl font-bold mb-4 font-comic">Bonus Quotidien !</h3>
                <p class="mb-4">Connecte-toi chaque jour pour gagner des pièces supplémentaires !</p>
                <button class="bg-white text-fun-orange px-6 py-3 rounded-full font-bold hover-zoom shadow-lg">
                    <i class="fas fa-gift mr-2"></i>
                    Récupérer mon bonus
                </button>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-white shadow-lg mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="text-center text-gray-600">
                <p>&copy; 2024 Big Mind - Apprentissage ludique pour tous</p>
            </div>
        </div>
    </footer>

    <script>
        // Détecteur d'appareil automatique
        class DeviceDetector {
            static isMobile() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)
                    || window.innerWidth <= 768
                    || ('ontouchstart' in window);
            }
            
            static isTablet() {
                return /iPad|Android/i.test(navigator.userAgent) && window.innerWidth >= 768 && window.innerWidth <= 1024;
            }
            
            static isDesktop() {
                return !this.isMobile() && !this.isTablet();
            }
            
            static getDeviceType() {
                if (this.isMobile()) return 'mobile';
                if (this.isTablet()) return 'tablet';
                return 'desktop';
            }
        }

        // Enhanced JavaScript functionality
        class LearningPlatform {
            constructor() {
                // Détecter automatiquement l'appareil
                this.deviceType = DeviceDetector.getDeviceType();
                this.isMobile = DeviceDetector.isMobile();
                console.log(`📱 Appareil détecté: ${this.deviceType}`);
                
                // Appliquer les styles selon l'appareil
                this.applyDeviceStyles();
                
                // Charger les données sauvegardées ou utiliser les valeurs par défaut
                this.loadGameData();
                
                
                this.quizData = this.initializeQuizData();
                this.videoData = this.initializeVideoData();
                this.currentVideo = null;
                this.videoQuizzes = this.initializeVideoQuizzes();
                this.currentQuiz = null;
                
                // Sauvegarder automatiquement toutes les 30 secondes
                this.startAutoSave();
                
                this.init();
                
                // Écouter les changements de taille d'écran
                window.addEventListener('resize', () => {
                    clearTimeout(this.resizeTimeout);
                    this.resizeTimeout = setTimeout(() => {
                        this.handleScreenSizeChange();
                    }, 250);
                });
                
                // Gestionnaires pour le menu mobile
                this.initMobileMenuHandlers();
            }
            
            handleScreenSizeChange() {
                const oldDeviceType = this.deviceType;
                const newDeviceType = DeviceDetector.getDeviceType();
                const newIsMobile = DeviceDetector.isMobile();
                
                if (oldDeviceType !== newDeviceType || this.isMobile !== newIsMobile) {
                    console.log(`🔄 Changement d'appareil: ${oldDeviceType} → ${newDeviceType}`);
                    
                    // Supprimer l'ancienne classe
                    document.body.classList.remove(`device-${oldDeviceType}`);
                    
                    // Mettre à jour les propriétés
                    this.deviceType = newDeviceType;
                    this.isMobile = newIsMobile;
                    
                    // Appliquer les nouveaux styles
                    this.applyDeviceStyles();
                    
                    // Mettre à jour l'affichage
                    this.updateDisplay();
                }
            }
            
            // Appliquer les styles automatiquement selon l'appareil
            applyDeviceStyles() {
                const body = document.body;
                
                // Ajouter la classe d'appareil au body
                body.classList.add(`device-${this.deviceType}`);
                
                if (this.isMobile) {
                    // Styles mobiles automatiques
                    this.applyMobileStyles();
                } else {
                    // Styles desktop automatiques  
                    this.applyDesktopStyles();
                }
            }
            
            applyMobileStyles() {
                const style = document.createElement('style');
                style.textContent = `
                    .device-mobile {
                        font-size: 16px !important;
                    }
                    
                    .device-mobile .max-w-7xl {
                        padding-left: 1rem !important;
                        padding-right: 1rem !important;
                    }
                    
                    .device-mobile .grid-cols-2 {
                        grid-template-columns: 1fr !important;
                    }
                    
                    .device-mobile .hover-zoom {
                        padding: 1rem !important;
                        margin-bottom: 1rem !important;
                    }
                    
                    .device-mobile .bg-fun-yellow,
                    .device-mobile .bg-blue-500 {
                        padding: 0.5rem 0.75rem !important;
                        font-size: 0.8rem !important;
                    }
                    
                    .device-mobile .flex.items-center:last-child {
                        flex-wrap: wrap !important;
                        gap: 0.25rem !important;
                    }
                    
                    .device-mobile h1.text-2xl {
                        font-size: 1.25rem !important;
                        line-height: 1.2 !important;
                    }
                    
                    .device-mobile .h-16 {
                        height: auto !important;
                        min-height: 4rem !important;
                        padding: 0.5rem 0 !important;
                    }
                    
                    .device-mobile .justify-between {
                        align-items: flex-start !important;
                        gap: 0.5rem !important;
                    }
                    
                    .device-mobile .mobile-header {
                        flex-direction: column !important;
                        align-items: stretch !important;
                        height: auto !important;
                        padding: 0.75rem 0 !important;
                        gap: 0.75rem !important;
                    }
                    
                    .device-mobile .mobile-header > div:first-child {
                        display: flex !important;
                        justify-content: center !important;
                        align-items: center !important;
                    }
                    
                    .device-mobile .mobile-header > div:last-child {
                        display: flex !important;
                        justify-content: center !important;
                        align-items: center !important;
                        flex-wrap: wrap !important;
                        gap: 0.5rem !important;
                    }
                    
                    .device-mobile .text-6xl {
                        font-size: 3rem !important;
                    }
                    
                    .device-mobile .text-4xl {
                        font-size: 2rem !important;
                    }
                    
                    .device-mobile .text-2xl {
                        font-size: 1.5rem !important;
                    }
                    
                    .device-mobile .modal-content {
                        margin: 1rem !important;
                        max-height: 90vh !important;
                        overflow-y: auto !important;
                    }
                    
                    .device-mobile .fixed {
                        padding: 0.5rem !important;
                    }
                    
                    .device-mobile button {
                        padding: 0.75rem 1.5rem !important;
                        font-size: 1rem !important;
                        min-height: 44px !important;
                    }
                    
                    .device-mobile .grid-cols-4 {
                        grid-template-columns: repeat(2, 1fr) !important;
                        gap: 0.75rem !important;
                    }
                    
                    /* Styles modales mobiles */
                    .mobile-modal {
                        position: fixed !important;
                        top: 0 !important;
                        left: 0 !important;
                        width: 100% !important;
                        height: 100% !important;
                        background: rgba(0,0,0,0.8) !important;
                        z-index: 1000 !important;
                    }
                    
                    .mobile-modal-content {
                        position: absolute !important;
                        bottom: 0 !important;
                        left: 0 !important;
                        width: 100% !important;
                        max-height: 90vh !important;
                        background: white !important;
                        border-radius: 20px 20px 0 0 !important;
                        overflow-y: auto !important;
                        animation: slideUp 0.3s ease-out !important;
                    }
                    
                    .mobile-modal-header {
                        position: sticky !important;
                        top: 0 !important;
                        background: white !important;
                        padding: 1rem !important;
                        border-bottom: 1px solid #e5e5e5 !important;
                        text-align: right !important;
                        border-radius: 20px 20px 0 0 !important;
                    }
                    
                    .mobile-close-btn {
                        background: #f3f4f6 !important;
                        border: none !important;
                        width: 40px !important;
                        height: 40px !important;
                        border-radius: 50% !important;
                        font-size: 1.5rem !important;
                        display: flex !important;
                        align-items: center !important;
                        justify-content: center !important;
                        cursor: pointer !important;
                        color: #6b7280 !important;
                    }
                    
                    .mobile-modal-body {
                        padding: 1.5rem !important;
                    }
                    
                    @keyframes slideUp {
                        from { transform: translateY(100%); }
                        to { transform: translateY(0); }
                    }
                    
                    /* Menu mobile plein écran */
                    .mobile-menu-item {
                        display: flex !important;
                        align-items: center !important;
                        justify-content: space-between !important;
                        padding: 1rem 1.5rem !important;
                        color: white !important;
                        text-decoration: none !important;
                        border-radius: 12px !important;
                        background: rgba(255, 255, 255, 0.1) !important;
                        border: 1px solid rgba(255, 255, 255, 0.2) !important;
                        transition: all 0.3s ease !important;
                        font-size: 1.1rem !important;
                        font-weight: 500 !important;
                    }
                    
                    .mobile-menu-item:hover,
                    .mobile-menu-item:active {
                        background: rgba(255, 255, 255, 0.2) !important;
                        transform: translateX(8px) !important;
                        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2) !important;
                    }
                    
                    .mobile-menu-item i:first-child {
                        width: 24px !important;
                        color: rgba(255, 255, 255, 0.9) !important;
                    }
                    
                    .mobile-menu-item span {
                        flex: 1 !important;
                        margin-left: 1rem !important;
                        text-align: left !important;
                    }
                    
                    #mobileMenuOverlay.menu-open {
                        transform: translateX(0) !important;
                    }
                `;
                document.head.appendChild(style);
                
                // Optimisations tactiles mobiles
                this.addTouchOptimizations();
                
                // Vérifier l'orientation
                window.addEventListener('orientationchange', () => {
                    setTimeout(() => this.handleOrientationChange(), 100);
                });
                
                // Prévenir le zoom sur double-tap
                document.addEventListener('touchstart', (e) => {
                    if (e.touches.length > 1) {
                        e.preventDefault();
                    }
                });
                
                let lastTouchEnd = 0;
                document.addEventListener('touchend', (e) => {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        e.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);
            }
            
            applyDesktopStyles() {
                const style = document.createElement('style');
                style.textContent = `
                    .device-desktop .hover-zoom:hover {
                        transform: scale(1.05) translateY(-5px);
                        transition: all 0.3s ease;
                    }
                    
                    .device-desktop #xpDisplay:hover,
                    .device-desktop #coinCounter:hover {
                        transform: scale(1.05);
                        cursor: pointer;
                    }
                `;
                document.head.appendChild(style);
            }
            
            addTouchOptimizations() {
                // Améliorer les interactions tactiles
                const style = document.createElement('style');
                style.textContent = `
                    .device-mobile * {
                        -webkit-tap-highlight-color: rgba(0,0,0,0.1) !important;
                        -webkit-touch-callout: none !important;
                        -webkit-user-select: none !important;
                        user-select: none !important;
                    }
                    
                    .device-mobile button,
                    .device-mobile .hover-zoom,
                    .device-mobile [onclick] {
                        touch-action: manipulation !important;
                        -webkit-tap-highlight-color: rgba(59, 130, 246, 0.3) !important;
                    }
                    
                    .device-mobile input,
                    .device-mobile textarea,
                    .device-mobile select {
                        -webkit-user-select: text !important;
                        user-select: text !important;
                    }
                    
                    .device-mobile .hover-zoom:active {
                        transform: scale(0.95) !important;
                        transition: transform 0.1s !important;
                    }
                    
                    .device-mobile button:active {
                        transform: scale(0.95) !important;
                        transition: transform 0.1s !important;
                    }
                `;
                document.head.appendChild(style);
            }
            
            handleOrientationChange() {
                // Recalculer le type d'appareil après rotation
                const newDeviceType = DeviceDetector.getDeviceType();
                if (newDeviceType !== this.deviceType) {
                    document.body.classList.remove(`device-${this.deviceType}`);
                    this.deviceType = newDeviceType;
                    this.isMobile = DeviceDetector.isMobile();
                    this.applyDeviceStyles();
                }
            }
            
            loadGameData() {
                try {
                    const savedData = localStorage.getItem('learningPlatformData');
                    if (savedData) {
                        const data = JSON.parse(savedData);
                        
                        // Nettoyer les données de test si présentes
                        if (data.coins === 1000 && !data.hasCreatedProfile) {
                            console.log('🧹 Nettoyage des données de test détectées');
                            localStorage.removeItem('learningPlatformData');
                            // Recharger avec des données par défaut
                            this.coins = 0;
                            this.studentName = 'Visiteur';
                            this.studentAge = null;
                            this.currentCharacter = 'robot';
                            this.inventory = ['robot'];
                            this.dailyBonusClaimed = false;
                            this.selectedClass = 'cp';
                            this.hasCreatedProfile = false;
                            this.subjects = {
                                math: { progress: 0, stars: 0 },
                                french: { progress: 0, stars: 0 },
                                science: { progress: 0, stars: 0 },
                                histgeo: { progress: 0, stars: 0 }
                            };
                            this.saveGameData();
                            this.showNotificationOnLoad('🆕 Données réinitialisées ! Nouveau départ ! 🎮');
                            return;
                        }
                        this.coins = data.coins || 0;
                        this.xp = data.xp || 0;
                        this.level = data.level || Math.floor((this.xp || 0) / 100) + 1;
                        this.studentName = data.studentName || 'Visiteur';
                        this.studentAge = data.studentAge || null;
                        this.currentCharacter = data.currentCharacter || 'robot';
                        this.inventory = data.inventory || ['robot'];
                        this.dailyBonusClaimed = data.dailyBonusClaimed || false;
                        this.selectedClass = data.selectedClass || 'cp';
                        this.hasCreatedProfile = data.hasCreatedProfile || false;
                        this.subjects = data.subjects || {
                            math: { progress: 0, stars: 0 },
                            french: { progress: 0, stars: 0 },
                            science: { progress: 0, stars: 0 },
                            histgeo: { progress: 0, stars: 0 }
                        };
                        this.questProgress = data.questProgress || 0;
                        this.completedQuests = data.completedQuests || [];
                        this.lastQuestDate = data.lastQuestDate || null;
                        this.currentQuests = data.currentQuests || [];
                        this.claimedRewards = data.claimedRewards || [];
                        this.currentChapter = data.currentChapter || 1;
                        this.unlockedChapters = data.unlockedChapters || [1];
                        console.log('✅ Données chargées !', data);
                        this.showNotificationOnLoad('Bienvenue ' + this.studentName + ' ! Tes données ont été chargées ! 🎮');
                    } else {
                        // Première visite - valeurs par défaut
                        this.coins = 0;
                        this.xp = 0;
                        this.level = 1;
                        this.studentName = 'Visiteur';
                        this.studentAge = null;
                        this.currentCharacter = 'robot';
                        this.inventory = ['robot'];
                        this.dailyBonusClaimed = false;
                        this.selectedClass = 'cp';
                        this.hasCreatedProfile = false;
                        this.subjects = {
                            math: { progress: 0, stars: 0 },
                            french: { progress: 0, stars: 0 },
                            science: { progress: 0, stars: 0 },
                            histgeo: { progress: 0, stars: 0 }
                        };
                        this.questProgress = 0;
                        this.completedQuests = [];
                        this.lastQuestDate = null;
                        this.currentQuests = [];
                        this.claimedRewards = [];
                        this.currentChapter = 1;
                        this.unlockedChapters = [1];
                        this.showNotificationOnLoad('Bienvenue ! Clique sur "Mon profil" pour créer ton compte ! 🎓');
                        this.saveGameData();
                    }
                } catch (error) {
                    console.error('Erreur lors du chargement:', error);
                    // En cas d'erreur, utiliser les valeurs par défaut
                    this.coins = 0;
                    this.xp = 0;
                    this.level = 1;
                    this.studentName = 'Visiteur';
                    this.studentAge = null;
                    this.currentCharacter = 'robot';
                    this.inventory = ['robot'];
                    this.dailyBonusClaimed = false;
                    this.selectedClass = 'cp';
                    this.hasCreatedProfile = false;
                    this.subjects = {
                        math: { progress: 0, stars: 0 },
                        french: { progress: 0, stars: 0 },
                        science: { progress: 0, stars: 0 },
                        histgeo: { progress: 0, stars: 0 }
                    };
                    this.questProgress = 0;
                    this.completedQuests = [];
                    this.lastQuestDate = null;
                    this.currentQuests = [];
                    this.claimedRewards = [];
                    this.currentChapter = 1;
                    this.unlockedChapters = [1];
                }
            }

            saveGameData() {
                try {
                    const dataToSave = {
                        coins: this.coins,
                        xp: this.xp,
                        level: this.level,
                        studentName: this.studentName,
                        studentAge: this.studentAge,
                        currentCharacter: this.currentCharacter,
                        inventory: this.inventory,
                        dailyBonusClaimed: this.dailyBonusClaimed,
                        selectedClass: this.selectedClass,
                        subjects: this.subjects,
                        questProgress: this.questProgress,
                        completedQuests: this.completedQuests,
                        lastQuestDate: this.lastQuestDate,
                        currentQuests: this.currentQuests,
                        claimedRewards: this.claimedRewards,
                        currentChapter: this.currentChapter,
                        unlockedChapters: this.unlockedChapters,
                        hasCreatedProfile: this.hasCreatedProfile || false,
                        lastSaved: new Date().toISOString()
                    };
                    localStorage.setItem('learningPlatformData', JSON.stringify(dataToSave));
                    console.log('💾 Données sauvegardées automatiquement');
                } catch (error) {
                    console.error('Erreur lors de la sauvegarde:', error);
                }
            }

            startAutoSave() {
                // Sauvegarder toutes les 30 secondes
                setInterval(() => {
                    this.saveGameData();
                }, 30000);
                
                // Sauvegarder quand la page se ferme
                window.addEventListener('beforeunload', () => {
                    this.saveGameData();
                });
                
                // Sauvegarder quand la page perd le focus
                window.addEventListener('blur', () => {
                    this.saveGameData();
                });
            }

            showNotificationOnLoad(message) {
                // Attendre que le DOM soit prêt avant d'afficher la notification
                setTimeout(() => {
                    if (document.getElementById('coinCounter')) {
                        this.showNotification(message);
                    }
                }, 1000);
            }

            openProfileSetup() {
                // Vérifier si l'utilisateur a déjà un profil
                if (this.hasCreatedProfile && this.studentName && this.studentName !== 'Visiteur') {
                    // Afficher le profil existant avec option de modification
                    const profileModal = this.createModal(`
                        <div class="text-center">
                            <h3 class="text-2xl font-bold mb-4 gradient-text">
                                <i class="fas fa-user-circle mr-2"></i>Mon Profil
                            </h3>
                            
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 mb-6">
                                <div class="text-6xl mb-4">🎓</div>
                                <h4 class="text-xl font-bold text-gray-800 mb-2">${this.studentName}</h4>
                                <p class="text-gray-600 mb-1">Âge : ${this.studentAge} ans</p>
                                <p class="text-gray-600 mb-4">Classe : ${this.selectedClass.toUpperCase()}</p>
                                <div class="flex items-center justify-center gap-4">
                                    <div class="flex items-center gap-2 text-yellow-600">
                                        <i class="fas fa-coins"></i>
                                        <span class="font-bold">${this.coins} pièces</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-blue-600">
                                        <i class="fas fa-star"></i>
                                        <span class="font-bold">⭐${this.xp} 🏆${this.level}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button class="flex-1 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 btn-bounce" 
                                        onclick="closeModal()">Fermer</button>
                                <button class="flex-1 bg-gradient-to-r from-fun-orange to-fun-yellow text-white px-4 py-2 rounded-lg hover:shadow-lg btn-bounce" 
                                        onclick="editProfile()">Modifier</button>
                            </div>
                        </div>
                    `);
                } else {
                    // Afficher le formulaire de création
                    const profileModal = this.createModal(`
                        <div class="text-center">
                            <h3 class="text-2xl font-bold mb-4 gradient-text">
                                <i class="fas fa-user-circle mr-2"></i>Créer Mon Profil
                            </h3>
                            <p class="text-gray-600 mb-6">Pour commencer ton aventure d'apprentissage, créé ou complète ton profil !</p>
                            
                            <div class="space-y-4 mb-6">
                                <div>
                                    <label class="block text-left text-sm font-bold text-gray-700 mb-2">Comment tu t'appelles ?</label>
                                    <input type="text" id="profileName" placeholder="Ton prénom" 
                                           class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" 
                                           maxlength="20">
                                </div>
                                
                                <div>
                                    <label class="block text-left text-sm font-bold text-gray-700 mb-2">Quel âge as-tu ?</label>
                                    <select id="profileAge" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                        <option value="">Sélectionne ton âge</option>
                                        <option value="6">6 ans</option>
                                        <option value="7">7 ans</option>
                                        <option value="8">8 ans</option>
                                        <option value="9">9 ans</option>
                                        <option value="10">10 ans</option>
                                        <option value="11">11 ans</option>
                                        <option value="12">12 ans</option>
                                        <option value="13">13 ans</option>
                                        <option value="14">14 ans</option>
                                        <option value="15">15 ans et plus</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-left text-sm font-bold text-gray-700 mb-2">Dans quelle classe es-tu ?</label>
                                    <select id="profileClass" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                        <option value="">Sélectionne ta classe</option>
                                        <option value="cp">CP</option>
                                        <option value="ce1">CE1</option>
                                        <option value="ce2">CE2</option>
                                        <option value="cm1">CM1</option>
                                        <option value="cm2">CM2</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button class="flex-1 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 btn-bounce" 
                                        onclick="closeModal()">Annuler</button>
                                <button class="flex-1 bg-gradient-to-r from-fun-blue to-fun-purple text-white px-4 py-2 rounded-lg hover:shadow-lg btn-bounce" 
                                        onclick="saveUserProfile()">Créer mon profil</button>
                            </div>
                        </div>
                    `);
                }
            }
            
            editProfile() {
                this.closeModal();
                // Rouvrir le formulaire avec les valeurs actuelles
                const profileModal = this.createModal(`
                    <div class="text-center">
                        <h3 class="text-2xl font-bold mb-4 gradient-text">
                            <i class="fas fa-user-edit mr-2"></i>Modifier Mon Profil
                        </h3>
                        <p class="text-gray-600 mb-6">Modifie les informations de ton profil</p>
                        
                        <div class="space-y-4 mb-6">
                            <div>
                                <label class="block text-left text-sm font-bold text-gray-700 mb-2">Comment tu t'appelles ?</label>
                                <input type="text" id="profileName" placeholder="Ton prénom" value="${this.studentName !== 'Visiteur' ? this.studentName : ''}" 
                                       class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500" 
                                       maxlength="20">
                            </div>
                            
                            <div>
                                <label class="block text-left text-sm font-bold text-gray-700 mb-2">Quel âge as-tu ?</label>
                                <select id="profileAge" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                    <option value="">Sélectionne ton âge</option>
                                    <option value="6" ${this.studentAge == '6' ? 'selected' : ''}>6 ans</option>
                                    <option value="7" ${this.studentAge == '7' ? 'selected' : ''}>7 ans</option>
                                    <option value="8" ${this.studentAge == '8' ? 'selected' : ''}>8 ans</option>
                                    <option value="9" ${this.studentAge == '9' ? 'selected' : ''}>9 ans</option>
                                    <option value="10" ${this.studentAge == '10' ? 'selected' : ''}>10 ans</option>
                                    <option value="11" ${this.studentAge == '11' ? 'selected' : ''}>11 ans</option>
                                    <option value="12" ${this.studentAge == '12' ? 'selected' : ''}>12 ans</option>
                                    <option value="13" ${this.studentAge == '13' ? 'selected' : ''}>13 ans</option>
                                    <option value="14" ${this.studentAge == '14' ? 'selected' : ''}>14 ans</option>
                                    <option value="15" ${this.studentAge == '15' ? 'selected' : ''}>15 ans et plus</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-left text-sm font-bold text-gray-700 mb-2">Dans quelle classe es-tu ?</label>
                                <select id="profileClass" class="w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-blue-500">
                                    <option value="">Sélectionne ta classe</option>
                                    <option value="cp" ${this.selectedClass == 'cp' ? 'selected' : ''}>CP</option>
                                    <option value="ce1" ${this.selectedClass == 'ce1' ? 'selected' : ''}>CE1</option>
                                    <option value="ce2" ${this.selectedClass == 'ce2' ? 'selected' : ''}>CE2</option>
                                    <option value="cm1" ${this.selectedClass == 'cm1' ? 'selected' : ''}>CM1</option>
                                    <option value="cm2" ${this.selectedClass == 'cm2' ? 'selected' : ''}>CM2</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="flex gap-3">
                            <button class="flex-1 bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 btn-bounce" 
                                    onclick="closeModal()">Annuler</button>
                            <button class="flex-1 bg-gradient-to-r from-fun-blue to-fun-purple text-white px-4 py-2 rounded-lg hover:shadow-lg btn-bounce" 
                                    onclick="saveUserProfile()">Sauvegarder</button>
                        </div>
                    </div>
                `);
            }

            saveUserProfile() {
                const name = document.getElementById('profileName').value.trim();
                const age = document.getElementById('profileAge').value;
                const studentClass = document.getElementById('profileClass').value;
                
                if (!name || name === '') {
                    this.showNotification('⚠️ Veuillez entrer votre prénom !');
                    return;
                }
                
                if (!age) {
                    this.showNotification('⚠️ Veuillez sélectionner votre âge !');
                    return;
                }
                
                if (!studentClass) {
                    this.showNotification('⚠️ Veuillez sélectionner votre classe !');
                    return;
                }
                
                // Sauvegarder les informations du profil
                this.studentName = name;
                this.studentAge = age;
                this.selectedClass = studentClass;
                this.hasCreatedProfile = true;
                
                // Mettre à jour l'affichage
                document.getElementById('studentName').textContent = name;
                
                // Fermer le modal
                this.closeModal();
                
                // Sauvegarder les données
                this.saveGameData();
                
                // Montrer un message de confirmation
                this.showNotification(`🎉 Profil créé avec succès ! Bienvenue ${name} !`);
            }

            askForName() {
                // Cette fonction est désactivée - redirection vers la page de profil
                return 'Visiteur';
            }

            initializeQuizData() {
                return {
                    math: [
                        {
                            question: "Combien font 7 x 8 ?",
                            answers: ["54", "56", "58", "62"],
                            correct: 1
                        },
                        {
                            question: "Quelle est la forme d'un carré ?",
                            answers: ["3 côtés", "4 côtés égaux", "5 côtés", "6 côtés"],
                            correct: 1
                        },
                        {
                            question: "Combien font 15 + 27 ?",
                            answers: ["41", "42", "43", "44"],
                            correct: 1
                        },
                        {
                            question: "Combien de minutes dans une heure ?",
                            answers: ["50", "60", "70", "80"],
                            correct: 1
                        },
                        {
                            question: "Quelle est la moitié de 100 ?",
                            answers: ["40", "45", "50", "55"],
                            correct: 2
                        }
                    ],
                    french: [
                        {
                            question: "Quel est le pluriel de 'cheval' ?",
                            answers: ["chevals", "chevaux", "chevaus", "chevales"],
                            correct: 1
                        },
                        {
                            question: "Comment s'écrit le son 'an' ?",
                            answers: ["en", "an", "on", "in"],
                            correct: 1
                        },
                        {
                            question: "Que veut dire 'synonyme' ?",
                            answers: ["mot contraire", "mot pareil", "mot difficile", "mot long"],
                            correct: 1
                        },
                        {
                            question: "Quelle est la première lettre de l'alphabet ?",
                            answers: ["B", "A", "C", "D"],
                            correct: 1
                        },
                        {
                            question: "Comment appelle-t-on une phrase qui pose une question ?",
                            answers: ["phrase exclamative", "phrase interrogative", "phrase déclarative", "phrase longue"],
                            correct: 1
                        }
                    ],
                    science: [
                        {
                            question: "De quoi les plantes ont-elles besoin pour grandir ?",
                            answers: ["Eau et lumière", "Seulement eau", "Seulement lumière", "Rien"],
                            correct: 0
                        },
                        {
                            question: "Combien de pattes a une araignée ?",
                            answers: ["6", "8", "10", "12"],
                            correct: 1
                        },
                        {
                            question: "Quel organe nous permet de respirer ?",
                            answers: ["Le coeur", "Les poumons", "L'estomac", "Le cerveau"],
                            correct: 1
                        },
                        {
                            question: "Que devient l'eau quand elle gèle ?",
                            answers: ["Vapeur", "Glace", "Sable", "Pierre"],
                            correct: 1
                        },
                        {
                            question: "Quelle planète est la plus proche du Soleil ?",
                            answers: ["Vénus", "Mars", "Mercure", "Jupiter"],
                            correct: 2
                        }
                    ],
                    history: [
                        {
                            question: "Qui était Napoléon ?",
                            answers: ["Un roi", "Un empereur", "Un président", "Un ministre"],
                            correct: 1
                        },
                        {
                            question: "Dans quelle ville se trouve la tour Eiffel ?",
                            answers: ["Lyon", "Marseille", "Paris", "Nice"],
                            correct: 2
                        },
                        {
                            question: "Que construisaient les Égyptiens dans le désert ?",
                            answers: ["Des châteaux", "Des pyramides", "Des ponts", "Des jardins"],
                            correct: 1
                        },
                        {
                            question: "Comment s'appelaient les guerriers du Moyen Âge ?",
                            answers: ["Soldats", "Chevaliers", "Pirates", "Vikings"],
                            correct: 1
                        },
                        {
                            question: "Quel animal était le symbole de la Gaule ?",
                            answers: ["L'aigle", "Le lion", "Le coq", "Le loup"],
                            correct: 2
                        }
                    ],
                    english: [
                        {
                            question: "Comment dit-on 'bonjour' en anglais ?",
                            answers: ["Goodbye", "Hello", "Thank you", "Please"],
                            correct: 1
                        },
                        {
                            question: "Que veut dire 'cat' en français ?",
                            answers: ["Chien", "Chat", "Oiseau", "Poisson"],
                            correct: 1
                        },
                        {
                            question: "Comment dit-on 'rouge' en anglais ?",
                            answers: ["Blue", "Green", "Red", "Yellow"],
                            correct: 2
                        },
                        {
                            question: "Que signifie 'Thank you' ?",
                            answers: ["Bonjour", "Au revoir", "Merci", "S'il vous plaît"],
                            correct: 2
                        },
                        {
                            question: "Comment dit-on 'un' en anglais ?",
                            answers: ["One", "Two", "Three", "Four"],
                            correct: 0
                        }
                    ],
                    geography: [
                        {
                            question: "Quel est le plus grand océan ?",
                            answers: ["Atlantique", "Indien", "Pacifique", "Arctique"],
                            correct: 2
                        },
                        {
                            question: "Sur quel continent se trouve la France ?",
                            answers: ["Asie", "Europe", "Afrique", "Amérique"],
                            correct: 1
                        },
                        {
                            question: "Quel est le plus long fleuve de France ?",
                            answers: ["La Seine", "La Loire", "Le Rhône", "La Garonne"],
                            correct: 1
                        },
                        {
                            question: "Dans quel pays se trouve Rome ?",
                            answers: ["France", "Espagne", "Italie", "Grèce"],
                            correct: 2
                        },
                        {
                            question: "Comment s'appelle la ligne qui sépare la Terre en deux ?",
                            answers: ["Méridien", "Équateur", "Tropique", "Parallèle"],
                            correct: 1
                        }
                    ]
                };
            }

            initializeVideoData() {
                return {
                    cp: {
                        math: [
                            {
                                id: "math_cp_1",
                                title: "Comparer des nombres jusqu'à 20",
                                youtube_id: "n5_B0GdNe-M",
                                thumbnail: "https://img.youtube.com/vi/n5_B0GdNe-M/maxresdefault.jpg",
                                description: "Apprendre à comparer les nombres jusqu'à 20",
                                duration: "8:45"
                            },
                            {
                                id: "math_cp_2", 
                                title: "Les doubles jusqu'à 10",
                                youtube_id: "G2827u4NpwU",
                                thumbnail: "https://img.youtube.com/vi/G2827u4NpwU/maxresdefault.jpg",
                                description: "Maîtriser les doubles jusqu'à 10",
                                duration: "12:30"
                            },
                            {
                                id: "math_cp_3",
                                title: "Pair et impair",
                                youtube_id: "3b3SGjBuKMc",
                                thumbnail: "https://img.youtube.com/vi/3b3SGjBuKMc/maxresdefault.jpg", 
                                description: "Distinguer les nombres pairs et impairs",
                                duration: "6:20"
                            },
                            {
                                id: "math_cp_4",
                                title: "Les soustractions",
                                youtube_id: "-Ga6DhnJPpE",
                                thumbnail: "https://img.youtube.com/vi/-Ga6DhnJPpE/maxresdefault.jpg",
                                description: "Apprendre les soustractions simples",
                                duration: "9:15"
                            },
                            {
                                id: "math_cp_5",
                                title: "Les unités dizaines",
                                youtube_id: "fvHSskq-8_8",
                                thumbnail: "https://img.youtube.com/vi/fvHSskq-8_8/maxresdefault.jpg",
                                description: "Comprendre les unités et les dizaines",
                                duration: "7:40"
                            },
                            {
                                id: "math_cp_6",
                                title: "Les formes géométriques",
                                youtube_id: "BJzXM0Fazq0",
                                thumbnail: "https://img.youtube.com/vi/BJzXM0Fazq0/maxresdefault.jpg",
                                description: "Découvrir les formes géométriques de base",
                                duration: "5:55"
                            },
                            {
                                id: "math_cp_7",
                                title: "Les suites de nombres",
                                youtube_id: "7kdCpfjRfPM",
                                thumbnail: "https://img.youtube.com/vi/7kdCpfjRfPM/maxresdefault.jpg",
                                description: "Maîtriser les suites de nombres",
                                duration: "10:25"
                            },
                            {
                                id: "math_cp_8",
                                title: "Les unités de longueur",
                                youtube_id: "n9HIfyMWhwI",
                                thumbnail: "https://img.youtube.com/vi/n9HIfyMWhwI/maxresdefault.jpg",
                                description: "Découvrir les unités de longueur",
                                duration: "8:10"
                            },
                            {
                                id: "math_cp_9",
                                title: "Comparer des longueurs",
                                youtube_id: "DRhaddgFwHU",
                                thumbnail: "https://img.youtube.com/vi/DRhaddgFwHU/maxresdefault.jpg",
                                description: "Apprendre à comparer les longueurs",
                                duration: "11:30"
                            }
                        ],
                        french: [
                            {
                                id: "french_cp_1",
                                title: "La phrase",
                                youtube_id: "KoR3qJK_wEc",
                                thumbnail: "https://img.youtube.com/vi/KoR3qJK_wEc/maxresdefault.jpg",
                                description: "Apprendre à construire une phrase",
                                duration: "Variable"
                            },
                            {
                                id: "french_cp_2",
                                title: "Les types de phrases",
                                youtube_id: "aGW2DfMLhCY",
                                thumbnail: "https://img.youtube.com/vi/aGW2DfMLhCY/maxresdefault.jpg",
                                description: "Découvrir les différents types de phrases",
                                duration: "Variable"
                            },
                            {
                                id: "french_cp_3",
                                title: "Le verbe",
                                youtube_id: "CBGA58qRawU",
                                thumbnail: "https://img.youtube.com/vi/CBGA58qRawU/maxresdefault.jpg",
                                description: "Comprendre ce qu'est un verbe",
                                duration: "Variable"
                            },
                            {
                                id: "french_cp_4",
                                title: "Les lettres et les mots",
                                youtube_id: "DR_66o6DOeI",
                                thumbnail: "https://img.youtube.com/vi/DR_66o6DOeI/maxresdefault.jpg",
                                description: "La relation entre lettres et mots",
                                duration: "Variable"
                            },
                            {
                                id: "french_cp_5",
                                title: "Le singulier et pluriel",
                                youtube_id: "liuYTks6rCs",
                                thumbnail: "https://img.youtube.com/vi/liuYTks6rCs/maxresdefault.jpg",
                                description: "Maîtriser le singulier et le pluriel",
                                duration: "Variable"
                            },
                            {
                                id: "french_cp_6",
                                title: "Définition d'une lettre, d'un son et d'une syllabe",
                                youtube_id: "ZtfSvJcgNqU",
                                thumbnail: "https://img.youtube.com/vi/ZtfSvJcgNqU/maxresdefault.jpg",
                                description: "Différencier lettre, son et syllabe",
                                duration: "Variable"
                            },
                            {
                                id: "french_cp_7",
                                title: "Les phrases affirmatives et négatives",
                                youtube_id: "zNHm9LvsxqE",
                                thumbnail: "https://img.youtube.com/vi/zNHm9LvsxqE/maxresdefault.jpg",
                                description: "Phrases positives et négatives",
                                duration: "Variable"
                            },
                            {
                                id: "french_cp_8",
                                title: "Le passé, présent et futur",
                                youtube_id: "R19HiQtL2Rk",
                                thumbnail: "https://img.youtube.com/vi/R19HiQtL2Rk/maxresdefault.jpg",
                                description: "Comprendre les temps : passé, présent, futur",
                                duration: "Variable"
                            },
                            {
                                id: "french_cp_9",
                                title: "La phrase interrogative",
                                youtube_id: "-0BnEnS8SRc",
                                thumbnail: "https://img.youtube.com/vi/-0BnEnS8SRc/maxresdefault.jpg",
                                description: "Apprendre à poser des questions",
                                duration: "Variable"
                            },
                            {
                                id: "french_cp_10",
                                title: "Comment recopier les phrases",
                                youtube_id: "Y0dYA4fZjpI",
                                thumbnail: "https://img.youtube.com/vi/Y0dYA4fZjpI/maxresdefault.jpg",
                                description: "Bien recopier un texte",
                                duration: "Variable"
                            },
                            {
                                id: "french_cp_11",
                                title: "Les histoires et les personnages",
                                youtube_id: "vrVr81xy-7Q",
                                thumbnail: "https://img.youtube.com/vi/vrVr81xy-7Q/maxresdefault.jpg",
                                description: "Découvrir la structure des histoires",
                                duration: "Variable"
                            }
                        ],
                        science: [
                            {
                                id: "science_cp_1",
                                title: "Sciences CP - Leçon 1",
                                youtube_id: "fW8bwgRDxSY",
                                thumbnail: "https://img.youtube.com/vi/fW8bwgRDxSY/maxresdefault.jpg",
                                description: "Apprentissage des sciences niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "science_cp_2",
                                title: "Sciences CP - Leçon 2",
                                youtube_id: "W7kfkC5Ru6Y",
                                thumbnail: "https://img.youtube.com/vi/W7kfkC5Ru6Y/maxresdefault.jpg",
                                description: "Apprentissage des sciences niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "science_cp_3",
                                title: "Sciences CP - Leçon 3",
                                youtube_id: "PysS4PzQTUg",
                                thumbnail: "https://img.youtube.com/vi/PysS4PzQTUg/maxresdefault.jpg",
                                description: "Apprentissage des sciences niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "science_cp_4",
                                title: "Sciences CP - Leçon 4",
                                youtube_id: "XSihVvrnK9g",
                                thumbnail: "https://img.youtube.com/vi/XSihVvrnK9g/maxresdefault.jpg",
                                description: "Apprentissage des sciences niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "science_cp_5",
                                title: "Sciences CP - Leçon 5",
                                youtube_id: "LHQKXtUxtUQ",
                                thumbnail: "https://img.youtube.com/vi/LHQKXtUxtUQ/maxresdefault.jpg",
                                description: "Apprentissage des sciences niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "science_cp_6",
                                title: "Sciences CP - Leçon 6",
                                youtube_id: "ZPqYwqsXQik",
                                thumbnail: "https://img.youtube.com/vi/ZPqYwqsXQik/maxresdefault.jpg",
                                description: "Apprentissage des sciences niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "science_cp_7",
                                title: "Sciences CP - Leçon 7",
                                youtube_id: "WmK2CHR31nc",
                                thumbnail: "https://img.youtube.com/vi/WmK2CHR31nc/maxresdefault.jpg",
                                description: "Apprentissage des sciences niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "science_cp_8",
                                title: "Sciences CP - Leçon 8",
                                youtube_id: "BWmoEXCCraM",
                                thumbnail: "https://img.youtube.com/vi/BWmoEXCCraM/maxresdefault.jpg",
                                description: "Apprentissage des sciences niveau CP",
                                duration: "Variable"
                            }
                        ],
                        histgeo: [
                            {
                                id: "histgeo_cp_1",
                                title: "Histoire-Géographie CP - Leçon 1",
                                youtube_id: "h_YkcmbRR4Q",
                                thumbnail: "https://img.youtube.com/vi/h_YkcmbRR4Q/maxresdefault.jpg",
                                description: "Apprentissage de l'histoire et géographie niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_cp_2",
                                title: "Histoire-Géographie CP - Leçon 2",
                                youtube_id: "E44fl8ZjtHM",
                                thumbnail: "https://img.youtube.com/vi/E44fl8ZjtHM/maxresdefault.jpg",
                                description: "Apprentissage de l'histoire et géographie niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_cp_3",
                                title: "Histoire-Géographie CP - Leçon 3",
                                youtube_id: "0hYCCSm3qDs",
                                thumbnail: "https://img.youtube.com/vi/0hYCCSm3qDs/maxresdefault.jpg",
                                description: "Apprentissage de l'histoire et géographie niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_cp_4",
                                title: "Histoire-Géographie CP - Leçon 4",
                                youtube_id: "nMX0NbKCWmg",
                                thumbnail: "https://img.youtube.com/vi/nMX0NbKCWmg/maxresdefault.jpg",
                                description: "Apprentissage de l'histoire et géographie niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_cp_5",
                                title: "Histoire-Géographie CP - Leçon 5",
                                youtube_id: "CbnALShWAkc",
                                thumbnail: "https://img.youtube.com/vi/CbnALShWAkc/maxresdefault.jpg",
                                description: "Apprentissage de l'histoire et géographie niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_cp_6",
                                title: "Histoire-Géographie CP - Leçon 6",
                                youtube_id: "8020w5OPi2E",
                                thumbnail: "https://img.youtube.com/vi/8020w5OPi2E/maxresdefault.jpg",
                                description: "Apprentissage de l'histoire et géographie niveau CP",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_cp_7",
                                title: "Histoire-Géographie CP - Leçon 7",
                                youtube_id: "7c9AGmps8ZA",
                                thumbnail: "https://img.youtube.com/vi/7c9AGmps8ZA/maxresdefault.jpg",
                                description: "Apprentissage de l'histoire et géographie niveau CP",
                                duration: "Variable"
                            }
                        ]
                    },
                    // Autres classes à ajouter
                    ce1: { 
                        math: [
                            {
                                id: "math_ce1_1",
                                title: "Mathématiques CE1 - Leçon 1",
                                youtube_id: "iVSY_zXH6DU",
                                thumbnail: "https://img.youtube.com/vi/iVSY_zXH6DU/maxresdefault.jpg",
                                description: "Apprentissage des mathématiques niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "math_ce1_2",
                                title: "Mathématiques CE1 - Leçon 2",
                                youtube_id: "eDedCNKREA0",
                                thumbnail: "https://img.youtube.com/vi/eDedCNKREA0/maxresdefault.jpg",
                                description: "Apprentissage des mathématiques niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "math_ce1_3",
                                title: "Mathématiques CE1 - Leçon 3",
                                youtube_id: "uNWrrne_NzU",
                                thumbnail: "https://img.youtube.com/vi/uNWrrne_NzU/maxresdefault.jpg",
                                description: "Apprentissage des mathématiques niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "math_ce1_4",
                                title: "Mathématiques CE1 - Leçon 4",
                                youtube_id: "otEvyrn5qe0",
                                thumbnail: "https://img.youtube.com/vi/otEvyrn5qe0/maxresdefault.jpg",
                                description: "Apprentissage des mathématiques niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "math_ce1_5",
                                title: "Mathématiques CE1 - Leçon 5",
                                youtube_id: "aZDo-a9_37g",
                                thumbnail: "https://img.youtube.com/vi/aZDo-a9_37g/maxresdefault.jpg",
                                description: "Apprentissage des mathématiques niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "math_ce1_6",
                                title: "Mathématiques CE1 - Leçon 6",
                                youtube_id: "Otwnpst8bvA",
                                thumbnail: "https://img.youtube.com/vi/Otwnpst8bvA/maxresdefault.jpg",
                                description: "Apprentissage des mathématiques niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "math_ce1_7",
                                title: "Mathématiques CE1 - Leçon 7",
                                youtube_id: "GNMjC_OKlVA",
                                thumbnail: "https://img.youtube.com/vi/GNMjC_OKlVA/maxresdefault.jpg",
                                description: "Apprentissage des mathématiques niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "math_ce1_8",
                                title: "Mathématiques CE1 - Leçon 8",
                                youtube_id: "hWKm3w_HQ64",
                                thumbnail: "https://img.youtube.com/vi/hWKm3w_HQ64/maxresdefault.jpg",
                                description: "Apprentissage des mathématiques niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "math_ce1_9",
                                title: "Mathématiques CE1 - Leçon 9",
                                youtube_id: "4vl-mbtv0wo",
                                thumbnail: "https://img.youtube.com/vi/4vl-mbtv0wo/maxresdefault.jpg",
                                description: "Apprentissage des mathématiques niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "math_ce1_10",
                                title: "Mathématiques CE1 - Leçon 10",
                                youtube_id: "bX7Bt3Cm3xc",
                                thumbnail: "https://img.youtube.com/vi/bX7Bt3Cm3xc/maxresdefault.jpg",
                                description: "Apprentissage des mathématiques niveau CE1",
                                duration: "Variable"
                            }
                        ],
                        french: [
                            {
                                id: "french_ce1_1",
                                title: "Français CE1 - Leçon 1",
                                youtube_id: "Ca2zBTr3caw",
                                thumbnail: "https://img.youtube.com/vi/Ca2zBTr3caw/maxresdefault.jpg",
                                description: "Apprentissage du français niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "french_ce1_2",
                                title: "Français CE1 - Leçon 2",
                                youtube_id: "luyObngrtJg",
                                thumbnail: "https://img.youtube.com/vi/luyObngrtJg/maxresdefault.jpg",
                                description: "Apprentissage du français niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "french_ce1_3",
                                title: "Français CE1 - Leçon 3",
                                youtube_id: "IpWESe0ghEI",
                                thumbnail: "https://img.youtube.com/vi/IpWESe0ghEI/maxresdefault.jpg",
                                description: "Apprentissage du français niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "french_ce1_4",
                                title: "Français CE1 - Leçon 4",
                                youtube_id: "O5vMKPnf-24",
                                thumbnail: "https://img.youtube.com/vi/O5vMKPnf-24/maxresdefault.jpg",
                                description: "Apprentissage du français niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "french_ce1_5",
                                title: "Français CE1 - Leçon 5",
                                youtube_id: "CoFoz-mIHrg",
                                thumbnail: "https://img.youtube.com/vi/CoFoz-mIHrg/maxresdefault.jpg",
                                description: "Apprentissage du français niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "french_ce1_6",
                                title: "Français CE1 - Leçon 6",
                                youtube_id: "WyQcS4sXJ_g",
                                thumbnail: "https://img.youtube.com/vi/WyQcS4sXJ_g/maxresdefault.jpg",
                                description: "Apprentissage du français niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "french_ce1_7",
                                title: "Français CE1 - Leçon 7",
                                youtube_id: "aGW2DfMLhCY",
                                thumbnail: "https://img.youtube.com/vi/aGW2DfMLhCY/maxresdefault.jpg",
                                description: "Apprentissage du français niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "french_ce1_8",
                                title: "Français CE1 - Leçon 8",
                                youtube_id: "p-jXhoJczzI",
                                thumbnail: "https://img.youtube.com/vi/p-jXhoJczzI/maxresdefault.jpg",
                                description: "Apprentissage du français niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "french_ce1_9",
                                title: "Français CE1 - Leçon 9",
                                youtube_id: "blu3Vw6Cws0",
                                thumbnail: "https://img.youtube.com/vi/blu3Vw6Cws0/maxresdefault.jpg",
                                description: "Apprentissage du français niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "french_ce1_10",
                                title: "Français CE1 - Leçon 10",
                                youtube_id: "BnEXRC9gZsU",
                                thumbnail: "https://img.youtube.com/vi/BnEXRC9gZsU/maxresdefault.jpg",
                                description: "Apprentissage du français niveau CE1",
                                duration: "Variable"
                            }
                        ],
                        science: [
                            {
                                id: "science_ce1_1",
                                title: "Sciences CE1 - Leçon 1",
                                youtube_id: "ErNNhtFHoJA",
                                thumbnail: "https://img.youtube.com/vi/ErNNhtFHoJA/maxresdefault.jpg",
                                description: "Apprentissage des sciences niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "science_ce1_2",
                                title: "Sciences CE1 - Leçon 2",
                                youtube_id: "nRf6O3-ka7g",
                                thumbnail: "https://img.youtube.com/vi/nRf6O3-ka7g/maxresdefault.jpg",
                                description: "Découverte scientifique niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "science_ce1_3",
                                title: "Sciences CE1 - Leçon 3",
                                youtube_id: "VZJZXqCTx8M",
                                thumbnail: "https://img.youtube.com/vi/VZJZXqCTx8M/maxresdefault.jpg",
                                description: "Découverte scientifique niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "science_ce1_4",
                                title: "Sciences CE1 - Leçon 4",
                                youtube_id: "souxNW4MCNA",
                                thumbnail: "https://img.youtube.com/vi/souxNW4MCNA/maxresdefault.jpg",
                                description: "Découverte scientifique niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "science_ce1_5",
                                title: "Sciences CE1 - Leçon 5",
                                youtube_id: "MO-T-XOWci8",
                                thumbnail: "https://img.youtube.com/vi/MO-T-XOWci8/maxresdefault.jpg",
                                description: "Découverte scientifique niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "science_ce1_6",
                                title: "Sciences CE1 - Leçon 6",
                                youtube_id: "un7vK3ARZTs",
                                thumbnail: "https://img.youtube.com/vi/un7vK3ARZTs/maxresdefault.jpg",
                                description: "Découverte scientifique niveau CE1",
                                duration: "Variable"
                            }
                        ], 
                        histgeo: [
                            {
                                id: "histgeo_ce1_1",
                                title: "Histoire-Géographie CE1 - Leçon 1",
                                youtube_id: "LEixNzWedVg",
                                thumbnail: "https://img.youtube.com/vi/LEixNzWedVg/maxresdefault.jpg",
                                description: "Apprentissage de l'histoire et géographie niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_ce1_2",
                                title: "Questionner le monde CE1 - Leçon 2",
                                youtube_id: "LDnlRA9_DzA",
                                thumbnail: "https://img.youtube.com/vi/LDnlRA9_DzA/maxresdefault.jpg",
                                description: "Découverte du monde niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_ce1_3",
                                title: "Questionner le monde CE1 - Leçon 3",
                                youtube_id: "vmfu8pb2z5o",
                                thumbnail: "https://img.youtube.com/vi/vmfu8pb2z5o/maxresdefault.jpg",
                                description: "Découverte du monde niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_ce1_4",
                                title: "Questionner le monde CE1 - Leçon 4",
                                youtube_id: "tLY7_YkZ9N8",
                                thumbnail: "https://img.youtube.com/vi/tLY7_YkZ9N8/maxresdefault.jpg",
                                description: "Découverte du monde niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_ce1_5",
                                title: "Questionner le monde CE1 - Leçon 5",
                                youtube_id: "bmInd66I3U4",
                                thumbnail: "https://img.youtube.com/vi/bmInd66I3U4/maxresdefault.jpg",
                                description: "Découverte du monde niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_ce1_6",
                                title: "Questionner le monde CE1 - Leçon 6",
                                youtube_id: "MO-T-XOWci8",
                                thumbnail: "https://img.youtube.com/vi/MO-T-XOWci8/maxresdefault.jpg",
                                description: "Découverte du monde niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_ce1_7",
                                title: "Questionner le monde CE1 - Leçon 7",
                                youtube_id: "qlZ6s4VmloA",
                                thumbnail: "https://img.youtube.com/vi/qlZ6s4VmloA/maxresdefault.jpg",
                                description: "Découverte du monde niveau CE1",
                                duration: "Variable"
                            },
                            {
                                id: "histgeo_ce1_8",
                                title: "Questionner le monde CE1 - Leçon 8",
                                youtube_id: "CHnqX-rVorg",
                                thumbnail: "https://img.youtube.com/vi/CHnqX-rVorg/maxresdefault.jpg",
                                description: "Découverte du monde niveau CE1",
                                duration: "Variable"
                            }
                        ] 
                    },
                    ce2: { 
                        math: [
                            {
                                id: "math_ce2_1",
                                title: "Les multiplications CE2 - Maître Lucas",
                                youtube_id: "8oy5MuztXBs",
                                thumbnail: "https://img.youtube.com/vi/8oy5MuztXBs/maxresdefault.jpg",
                                description: "Apprendre les multiplications",
                                duration: "13:25"
                            }
                        ],
                        french: [
                            {
                                id: "french_ce2_1",
                                title: "La conjugaison CE2 - Maître Lucas",
                                youtube_id: "Y2uGNkLJ-4Y",
                                thumbnail: "https://img.youtube.com/vi/Y2uGNkLJ-4Y/maxresdefault.jpg",
                                description: "Les temps de conjugaison",
                                duration: "9:30"
                            }
                        ],
                        science: [], 
                        histgeo: [] 
                    },
                    cm1: { 
                        math: [
                            {
                                id: "math_cm1_1",
                                title: "Les fractions CM1 - Maître Lucas",
                                youtube_id: "BLpEl7ZTYOE",
                                thumbnail: "https://img.youtube.com/vi/BLpEl7ZTYOE/maxresdefault.jpg",
                                description: "Comprendre les fractions",
                                duration: "14:15"
                            }
                        ],
                        french: [
                            {
                                id: "french_cm1_1",
                                title: "L'analyse grammaticale CM1 - Maître Lucas",
                                youtube_id: "kPg7fZ-9Mwg",
                                thumbnail: "https://img.youtube.com/vi/kPg7fZ-9Mwg/maxresdefault.jpg",
                                description: "Analyser les phrases",
                                duration: "12:40"
                            }
                        ],
                        science: [], 
                        histgeo: [] 
                    },
                    cm2: { 
                        math: [
                            {
                                id: "math_cm2_1",
                                title: "Les décimaux CM2 - Maître Lucas",
                                youtube_id: "vKxQNu6p4es",
                                thumbnail: "https://img.youtube.com/vi/vKxQNu6p4es/maxresdefault.jpg",
                                description: "Comprendre les nombres décimaux",
                                duration: "15:50"
                            }
                        ],
                        french: [
                            {
                                id: "french_cm2_1",
                                title: "Les types de phrases CM2 - Maître Lucas",
                                youtube_id: "Dj8xLHqJ8ZY",
                                thumbnail: "https://img.youtube.com/vi/Dj8xLHqJ8ZY/maxresdefault.jpg",
                                description: "Phrases déclaratives, interrogatives...",
                                duration: "10:25"
                            }
                        ],
                        science: [], 
                        histgeo: [] 
                    }
                };
            }

            initializeVideoQuizzes() {
                return {
                    // Quiz CP Mathématiques - Vidéo 1: Comparer des nombres jusqu'à 20
                    math_cp_1: [
                        {
                            question: "Quel nombre est le plus grand : 15 ou 18 ?",
                            type: "qcm",
                            answers: ["15", "18", "Ils sont égaux", "Je ne sais pas"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "17 est plus grand que 14",
                            type: "truefalse", 
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Quel nombre vient après 19 ?",
                            type: "short",
                            correct: "20",
                            coins: 5
                        },
                        {
                            question: "Range ces nombres du plus petit au plus grand : 12, 8, 15",
                            type: "qcm",
                            answers: ["8, 12, 15", "12, 8, 15", "15, 12, 8", "8, 15, 12"],
                            correct: 0,
                            coins: 10
                        }
                    ],
                    // Quiz CP Mathématiques - Vidéo 2: Les doubles jusqu'à 10
                    math_cp_2: [
                        {
                            question: "Le double de 5, c'est ?",
                            type: "qcm",
                            answers: ["8", "9", "10", "11"],
                            correct: 2,
                            coins: 5
                        },
                        {
                            question: "4 + 4 = 8",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Quel est le double de 3 ?",
                            type: "short",
                            correct: "6",
                            coins: 5
                        },
                        {
                            question: "Le double de 7, c'est ?",
                            type: "short",
                            correct: "14",
                            coins: 10
                        }
                    ],
                    // Quiz CP Mathématiques - Vidéo 3: Pair et impair
                    math_cp_3: [
                        {
                            question: "Le nombre 6 est-il pair ou impair ?",
                            type: "qcm",
                            answers: ["Pair", "Impair", "Les deux", "Ni l'un ni l'autre"],
                            correct: 0,
                            coins: 5
                        },
                        {
                            question: "9 est un nombre pair",
                            type: "truefalse",
                            correct: false,
                            coins: 5
                        },
                        {
                            question: "Donne un nombre pair entre 10 et 15",
                            type: "short",
                            correct: "12",
                            coins: 5
                        },
                        {
                            question: "Combien y a-t-il de nombres pairs entre 1 et 10 ?",
                            type: "qcm",
                            answers: ["4", "5", "6", "3"],
                            correct: 1,
                            coins: 10
                        }
                    ],
                    // Quiz CP Mathématiques - Vidéo 4: Les soustractions
                    math_cp_4: [
                        {
                            question: "Combien fait 8 - 3 ?",
                            type: "qcm",
                            answers: ["4", "5", "6", "7"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "10 - 6 = 4",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Combien fait 15 - 7 ?",
                            type: "short",
                            correct: "8",
                            coins: 5
                        },
                        {
                            question: "Si j'ai 12 bonbons et que j'en mange 4, combien m'en reste-t-il ?",
                            type: "short",
                            correct: "8",
                            coins: 10
                        }
                    ],
                    // Quiz CP Mathématiques - Vidéo 5: Les unités dizaines
                    math_cp_5: [
                        {
                            question: "Dans le nombre 17, combien y a-t-il de dizaines ?",
                            type: "qcm",
                            answers: ["1", "7", "17", "0"],
                            correct: 0,
                            coins: 5
                        },
                        {
                            question: "Dans 23, il y a 2 dizaines et 3 unités",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Combien d'unités dans le nombre 19 ?",
                            type: "short",
                            correct: "9",
                            coins: 5
                        },
                        {
                            question: "Quel nombre s'écrit avec 1 dizaine et 5 unités ?",
                            type: "short",
                            correct: "15",
                            coins: 10
                        }
                    ],
                    // Quiz CP Mathématiques - Vidéo 6: Les formes géométriques
                    math_cp_6: [
                        {
                            question: "Combien de côtés a un triangle ?",
                            type: "qcm",
                            answers: ["2", "3", "4", "5"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Un carré a 4 côtés égaux",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Comment s'appelle une forme ronde ?",
                            type: "short",
                            correct: "cercle",
                            coins: 5
                        },
                        {
                            question: "Combien d'angles a un rectangle ?",
                            type: "qcm",
                            answers: ["3", "4", "5", "6"],
                            correct: 1,
                            coins: 10
                        }
                    ],
                    // Quiz CP Mathématiques - Vidéo 7: Les suites de nombres
                    math_cp_7: [
                        {
                            question: "Quel nombre vient après 16 dans la suite ?",
                            type: "qcm",
                            answers: ["15", "17", "18", "19"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Dans la suite 2, 4, 6, 8, le nombre suivant est 10",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Complète la suite : 5, 10, 15, ?",
                            type: "short",
                            correct: "20",
                            coins: 5
                        },
                        {
                            question: "Quel nombre manque : 1, 3, 5, ?, 9",
                            type: "short",
                            correct: "7",
                            coins: 10
                        }
                    ],
                    // Quiz CP Mathématiques - Vidéo 8: Les unités de longueur
                    math_cp_8: [
                        {
                            question: "Avec quoi mesure-t-on la longueur ?",
                            type: "qcm",
                            answers: ["Une balance", "Une règle", "Un verre", "Une cuillère"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Le mètre est plus grand que le centimètre",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Combien de centimètres dans un mètre ?",
                            type: "short",
                            correct: "100",
                            coins: 5
                        },
                        {
                            question: "Quelle est l'unité la plus petite : cm ou m ?",
                            type: "short",
                            correct: "cm",
                            coins: 10
                        }
                    ],
                    // Quiz CP Mathématiques - Vidéo 9: Comparer des longueurs
                    math_cp_9: [
                        {
                            question: "Lequel est le plus long : un crayon ou une règle ?",
                            type: "qcm",
                            answers: ["Le crayon", "La règle", "Ils sont égaux", "Ça dépend"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "5 cm est plus petit que 8 cm",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Combien mesure ta main environ ?",
                            type: "qcm",
                            answers: ["2 cm", "10 cm", "50 cm", "1 m"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Range du plus petit au plus grand : 15 cm, 8 cm, 12 cm",
                            type: "short",
                            correct: "8 cm, 12 cm, 15 cm",
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 1: La phrase
                    french_cp_1: [
                        {
                            question: "Une phrase commence par une majuscule et finit par un point",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Qu'est-ce qu'une phrase ?",
                            type: "qcm",
                            answers: ["Un groupe de lettres", "Un groupe de mots qui a du sens", "Un seul mot", "Une liste de mots"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Par quoi commence une phrase ?",
                            type: "short",
                            correct: "majuscule",
                            coins: 5
                        },
                        {
                            question: "Corrige cette phrase : le chat mange des croquettes",
                            type: "short",
                            correct: "Le chat mange des croquettes.",
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 2: Les types de phrases
                    french_cp_2: [
                        {
                            question: "Il y a différents types de phrases",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Une phrase qui raconte quelque chose est :",
                            type: "qcm",
                            answers: ["Déclarative", "Interrogative", "Exclamative", "Impérative"],
                            correct: 0,
                            coins: 5
                        },
                        {
                            question: "Quel type de phrase est : \"Tu es en CP\" ?",
                            type: "short",
                            correct: "déclarative",
                            coins: 5
                        },
                        {
                            question: "Une phrase exclamative exprime :",
                            type: "qcm",
                            answers: ["Une question", "Un ordre", "Une émotion forte", "Une information"],
                            correct: 2,
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 3: Le verbe
                    french_cp_3: [
                        {
                            question: "Le verbe exprime une action",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Dans la phrase \"Le chat dort\", le verbe est :",
                            type: "qcm",
                            answers: ["Le", "chat", "dort", "Le chat"],
                            correct: 2,
                            coins: 5
                        },
                        {
                            question: "Trouve le verbe : Les enfants jouent dans la cour",
                            type: "short",
                            correct: "jouent",
                            coins: 5
                        },
                        {
                            question: "Quel est le verbe dans : \"Maman cuisine un gâteau\" ?",
                            type: "short",
                            correct: "cuisine",
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 4: Les lettres et les mots
                    french_cp_4: [
                        {
                            question: "Un mot est formé de plusieurs lettres",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Combien de lettres dans le mot CHAT ?",
                            type: "qcm",
                            answers: ["3", "4", "5", "6"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Combien de lettres dans MAISON ?",
                            type: "short",
                            correct: "6",
                            coins: 5
                        },
                        {
                            question: "Avec les lettres C-A-R, on peut écrire :",
                            type: "short",
                            correct: "CAR",
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 5: Le singulier et pluriel
                    french_cp_5: [
                        {
                            question: "Au pluriel, on ajoute souvent un S à la fin du mot",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Quel est le pluriel de CHAT ?",
                            type: "qcm",
                            answers: ["CHAT", "CHATS", "CHATES", "CHATSS"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Écris au pluriel : LIVRE",
                            type: "short",
                            correct: "LIVRES",
                            coins: 5
                        },
                        {
                            question: "Quel est le singulier de CHIENS ?",
                            type: "short",
                            correct: "CHIEN",
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 6: Définition d'une lettre, d'un son et d'une syllabe
                    french_cp_6: [
                        {
                            question: "Une lettre peut faire un son",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Qu'est-ce qu'une syllabe ?",
                            type: "qcm",
                            answers: ["Un son", "Une lettre", "Un groupe de sons", "Un mot"],
                            correct: 2,
                            coins: 5
                        },
                        {
                            question: "Combien de syllabes dans PA-PA ?",
                            type: "short",
                            correct: "2",
                            coins: 5
                        },
                        {
                            question: "La lettre A fait quel son ?",
                            type: "short",
                            correct: "[a]",
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 7: Les phrases affirmatives et négatives
                    french_cp_7: [
                        {
                            question: "Une phrase affirmative dit OUI, une phrase négative dit NON",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Quelle phrase est négative ?",
                            type: "qcm",
                            answers: ["Je mange une pomme", "Je ne mange pas", "Il fait beau", "Tu es gentil"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Transforme en négatif : Je veux jouer",
                            type: "short",
                            correct: "Je ne veux pas jouer",
                            coins: 5
                        },
                        {
                            question: "Quelle phrase est affirmative ?",
                            type: "qcm",
                            answers: ["Il ne pleut pas", "Je n'ai pas faim", "Le soleil brille", "Tu ne viens pas"],
                            correct: 2,
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 8: Le passé, présent et futur
                    french_cp_8: [
                        {
                            question: "Le présent, c'est maintenant",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "\"Hier, j'ai joué\" est au :",
                            type: "qcm",
                            answers: ["Présent", "Passé", "Futur", "Conditionnel"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "\"Je mange\" est au présent, passé ou futur ?",
                            type: "short",
                            correct: "présent",
                            coins: 5
                        },
                        {
                            question: "\"Demain, je jouerai\" est au :",
                            type: "qcm",
                            answers: ["Présent", "Passé", "Futur", "Imparfait"],
                            correct: 2,
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 9: La phrase interrogative
                    french_cp_9: [
                        {
                            question: "Une phrase interrogative pose une question",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Une phrase interrogative se termine par :",
                            type: "qcm",
                            answers: ["Un point", "Un point d'interrogation", "Un point d'exclamation", "Une virgule"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Quel signe termine : \"Comment tu t'appelles\" ?",
                            type: "short",
                            correct: "?",
                            coins: 5
                        },
                        {
                            question: "Transforme en question : Tu aimes les bonbons",
                            type: "short",
                            correct: "Est-ce que tu aimes les bonbons ?",
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 10: Comment recopier les phrases
                    french_cp_10: [
                        {
                            question: "Pour bien recopier, il faut écrire soigneusement",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Quand on recopie, il faut respecter :",
                            type: "qcm",
                            answers: ["Seulement les lettres", "Les majuscules et les points", "Seulement la ponctuation", "Rien du tout"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Que faut-il vérifier quand on recopie ?",
                            type: "short",
                            correct: "les majuscules et les points",
                            coins: 5
                        },
                        {
                            question: "Recopie correctement : le CHIEN mange",
                            type: "short",
                            correct: "Le chien mange.",
                            coins: 10
                        }
                    ],
                    // Quiz CP Français - Vidéo 11: Quiz bonus
                    french_cp_11: [
                        {
                            question: "Une histoire a un début, un milieu et une fin",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Dans une histoire, les personnages :",
                            type: "qcm",
                            answers: ["Ne font rien", "Vivent des aventures", "Dorment tout le temps", "Mangent seulement"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Comment commence souvent une histoire ?",
                            type: "short",
                            correct: "Il était une fois",
                            coins: 5
                        },
                        {
                            question: "Raconte le début d'une histoire avec un chat",
                            type: "short",
                            correct: "Il était une fois un petit chat",
                            coins: 10
                        }
                    ],
                    science_1: [
                        {
                            question: "L'eau s'évapore avec la chaleur du soleil",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Quels sont les 3 états de l'eau ?",
                            type: "qcm",
                            answers: ["Solide, liquide, gaz", "Chaud, froid, tiède", "Blanc, bleu, transparent", "Sucré, salé, amer"],
                            correct: 0
                        },
                        {
                            question: "Que devient l'eau quand elle gèle ?",
                            type: "short",
                            correct: "glace"
                        }
                    ],
                    science_2: [
                        {
                            question: "Il y a 4 saisons dans l'année",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Quelle saison vient après l'hiver ?",
                            type: "qcm",
                            answers: ["Automne", "Printemps", "Été", "Hiver"],
                            correct: 1
                        },
                        {
                            question: "En quelle saison les feuilles tombent-elles ?",
                            type: "short",
                            correct: "automne"
                        }
                    ],
                    science_3: [
                        {
                            question: "La vache donne du lait",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Quel animal fait 'cocorico' ?",
                            type: "qcm",
                            answers: ["Le cochon", "Le coq", "La vache", "Le mouton"],
                            correct: 1
                        },
                        {
                            question: "De quel animal vient le jambon ?",
                            type: "short",
                            correct: "cochon"
                        }
                    ],
                    history_1: [
                        {
                            question: "Les dinosaures ont vécu avant les humains",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Comment s'appelaient les premiers humains ?",
                            type: "qcm",
                            answers: ["Les Gaulois", "Les hommes préhistoriques", "Les Romains", "Les Vikings"],
                            correct: 1
                        },
                        {
                            question: "Avec quoi les hommes préhistoriques faisaient-ils du feu ?",
                            type: "short",
                            correct: "pierre"
                        }
                    ],
                    history_2: [
                        {
                            question: "Les chevaliers vivaient dans des châteaux forts",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Que portaient les chevaliers pour se protéger ?",
                            type: "qcm",
                            answers: ["Une armure", "Un costume", "Une robe", "Un pyjama"],
                            correct: 0
                        },
                        {
                            question: "Comment s'appelle l'époque des châteaux et chevaliers ?",
                            type: "short",
                            correct: "moyen age"
                        }
                    ],
                    history_3: [
                        {
                            question: "Louis XIV était appelé le Roi-Soleil",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Où vivait le Roi-Soleil ?",
                            type: "qcm",
                            answers: ["Au Louvre", "À Versailles", "À la Tour Eiffel", "À Notre-Dame"],
                            correct: 1
                        },
                        {
                            question: "Comment dit-on 14 en chiffres romains ?",
                            type: "short",
                            correct: "XIV"
                        }
                    ],
                    english_1: [
                        {
                            question: "L'alphabet anglais a 26 lettres",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Comment dit-on 'bonjour' en anglais ?",
                            type: "qcm",
                            answers: ["Goodbye", "Hello", "Thank you", "Please"],
                            correct: 1
                        },
                        {
                            question: "Quelle est la première lettre de l'alphabet anglais ?",
                            type: "short",
                            correct: "A"
                        }
                    ],
                    english_2: [
                        {
                            question: "'Red' signifie 'rouge' en français",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Comment dit-on 'bleu' en anglais ?",
                            type: "qcm",
                            answers: ["Red", "Green", "Blue", "Yellow"],
                            correct: 2
                        },
                        {
                            question: "De quelle couleur est le soleil ?",
                            type: "short",
                            correct: "yellow"
                        }
                    ],
                    english_3: [
                        {
                            question: "'One' signifie 'un' en français",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Comment dit-on '5' en anglais ?",
                            type: "qcm",
                            answers: ["Four", "Five", "Six", "Seven"],
                            correct: 1
                        },
                        {
                            question: "Combien font 10 + 10 en anglais ?",
                            type: "short",
                            correct: "twenty"
                        }
                    ],
                    geography_1: [
                        {
                            question: "Il y a 7 continents sur Terre",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Sur quel continent vivons-nous en France ?",
                            type: "qcm",
                            answers: ["Asie", "Europe", "Afrique", "Amérique"],
                            correct: 1
                        },
                        {
                            question: "Quel est le plus grand continent ?",
                            type: "short",
                            correct: "asie"
                        }
                    ],
                    geography_2: [
                        {
                            question: "Paris est la capitale de la France",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Dans quelle région se trouve Paris ?",
                            type: "qcm",
                            answers: ["Provence", "Bretagne", "Île-de-France", "Normandie"],
                            correct: 2
                        },
                        {
                            question: "Quel fleuve traverse Paris ?",
                            type: "short",
                            correct: "seine"
                        }
                    ],
                    geography_3: [
                        {
                            question: "Le Pacifique est le plus grand océan",
                            type: "truefalse",
                            correct: true
                        },
                        {
                            question: "Combien y a-t-il d'océans sur Terre ?",
                            type: "qcm",
                            answers: ["3", "4", "5", "6"],
                            correct: 2
                        },
                        {
                            question: "Comment s'appelle la mer qui borde la France au sud ?",
                            type: "short",
                            correct: "méditerranée"
                        }
                    ],
                    // Quiz CP Sciences - Vidéo 1
                    science_cp_1: [
                        {
                            question: "L'eau s'évapore avec la chaleur du soleil",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Quels sont les 3 états de l'eau ?",
                            type: "qcm",
                            answers: ["Solide, liquide, gaz", "Chaud, froid, tiède", "Blanc, bleu, transparent", "Sucré, salé, amer"],
                            correct: 0,
                            coins: 5
                        },
                        {
                            question: "Que devient l'eau quand elle gèle ?",
                            type: "short",
                            correct: "glace",
                            coins: 5
                        },
                        {
                            question: "Où va l'eau quand elle s'évapore ?",
                            type: "qcm",
                            answers: ["Dans la terre", "Dans le ciel", "Elle disparaît", "Dans les tuyaux"],
                            correct: 1,
                            coins: 10
                        }
                    ],
                    // Quiz CP Sciences - Vidéo 2
                    science_cp_2: [
                        {
                            question: "Il y a 4 saisons dans l'année",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Quelle saison vient après l'hiver ?",
                            type: "qcm",
                            answers: ["Automne", "Printemps", "Été", "Hiver"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "En quelle saison les feuilles tombent-elles ?",
                            type: "short",
                            correct: "automne",
                            coins: 5
                        },
                        {
                            question: "En quelle saison fait-il le plus chaud ?",
                            type: "short",
                            correct: "été",
                            coins: 10
                        }
                    ],
                    // Quiz CP Sciences - Vidéo 3
                    science_cp_3: [
                        {
                            question: "La vache donne du lait",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Quel animal fait 'cocorico' ?",
                            type: "qcm",
                            answers: ["Le cochon", "Le coq", "La vache", "Le mouton"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "De quel animal vient le jambon ?",
                            type: "short",
                            correct: "cochon",
                            coins: 5
                        },
                        {
                            question: "Quel animal pond des oeufs ?",
                            type: "qcm",
                            answers: ["Le cheval", "La poule", "Le chien", "Le mouton"],
                            correct: 1,
                            coins: 10
                        }
                    ],
                    // Quiz CP Sciences - Vidéo 4
                    science_cp_4: [
                        {
                            question: "Les plantes ont besoin d'eau pour grandir",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "De quoi ont besoin les plantes ?",
                            type: "qcm",
                            answers: ["Eau et lumière", "Seulement eau", "Seulement lumière", "Rien"],
                            correct: 0,
                            coins: 5
                        },
                        {
                            question: "Quelle partie de la plante est sous terre ?",
                            type: "short",
                            correct: "racines",
                            coins: 5
                        },
                        {
                            question: "Comment s'appellent les parties vertes de la plante ?",
                            type: "short",
                            correct: "feuilles",
                            coins: 10
                        }
                    ],
                    // Quiz CP Sciences - Vidéo 5
                    science_cp_5: [
                        {
                            question: "Le soleil nous réchauffe",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Le soleil est :",
                            type: "qcm",
                            answers: ["Une planète", "Une étoile", "Un satellite", "Un nuage"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Quand fait-il nuit ?",
                            type: "short",
                            correct: "quand le soleil se couche",
                            coins: 5
                        },
                        {
                            question: "Combien de temps met la Terre pour tourner sur elle-même ?",
                            type: "qcm",
                            answers: ["1 heure", "1 jour", "1 semaine", "1 mois"],
                            correct: 1,
                            coins: 10
                        }
                    ],
                    // Quiz CP Sciences - Vidéo 6
                    science_cp_6: [
                        {
                            question: "Nous avons 5 sens",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Avec quoi sentons-nous les odeurs ?",
                            type: "qcm",
                            answers: ["Les yeux", "Le nez", "La bouche", "Les oreilles"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Quel sens utilises-tu pour voir ?",
                            type: "short",
                            correct: "la vue",
                            coins: 5
                        },
                        {
                            question: "Cite les 5 sens",
                            type: "short",
                            correct: "vue, ouïe, odorat, goût, toucher",
                            coins: 10
                        }
                    ],
                    // Quiz CP Sciences - Vidéo 7
                    science_cp_7: [
                        {
                            question: "Il faut se laver les dents tous les jours",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Pour être en bonne santé, il faut :",
                            type: "qcm",
                            answers: ["Bien manger et dormir", "Regarder la télé", "Rester assis", "Manger des bonbons"],
                            correct: 0,
                            coins: 5
                        },
                        {
                            question: "Combien d'heures un enfant doit-il dormir ?",
                            type: "qcm",
                            answers: ["5 heures", "8 heures", "10 heures", "15 heures"],
                            correct: 2,
                            coins: 5
                        },
                        {
                            question: "Que faut-il faire avant de manger ?",
                            type: "short",
                            correct: "se laver les mains",
                            coins: 10
                        }
                    ],
                    // Quiz CP Sciences - Vidéo 8
                    science_cp_8: [
                        {
                            question: "L'air est invisible",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "L'air est partout autour de nous",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Qu'est-ce qui fait bouger les feuilles des arbres ?",
                            type: "short",
                            correct: "le vent",
                            coins: 5
                        },
                        {
                            question: "Comment s'appelle l'air qui bouge ?",
                            type: "short",
                            correct: "le vent",
                            coins: 10
                        }
                    ],
                    // Quiz CP Histoire-Géographie - Vidéo 1
                    histgeo_cp_1: [
                        {
                            question: "Nous vivons en France",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "La capitale de la France est :",
                            type: "qcm",
                            answers: ["Lyon", "Paris", "Marseille", "Nice"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Dans quel pays vivons-nous ?",
                            type: "short",
                            correct: "France",
                            coins: 5
                        },
                        {
                            question: "Comment s'appelle le président de la France ?",
                            type: "short",
                            correct: "Emmanuel Macron",
                            coins: 10
                        }
                    ],
                    // Quiz CP Histoire-Géographie - Vidéo 2
                    histgeo_cp_2: [
                        {
                            question: "Il y a 7 jours dans une semaine",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Combien y a-t-il de mois dans une année ?",
                            type: "qcm",
                            answers: ["10", "11", "12", "13"],
                            correct: 2,
                            coins: 5
                        },
                        {
                            question: "Quel mois vient après janvier ?",
                            type: "short",
                            correct: "février",
                            coins: 5
                        },
                        {
                            question: "En quel mois fête-t-on Noël ?",
                            type: "short",
                            correct: "décembre",
                            coins: 10
                        }
                    ],
                    // Quiz CP Histoire-Géographie - Vidéo 3
                    histgeo_cp_3: [
                        {
                            question: "Autrefois, les châteaux étaient habités par des rois",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Les chevaliers vivaient au temps :",
                            type: "qcm",
                            answers: ["D'aujourd'hui", "Du Moyen Âge", "De demain", "De l'été"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Comment s'appelle la maison du roi ?",
                            type: "short",
                            correct: "château",
                            coins: 5
                        },
                        {
                            question: "Avec quoi se battaient les chevaliers ?",
                            type: "qcm",
                            answers: ["Des épées", "Des stylos", "Des fleurs", "Des livres"],
                            correct: 0,
                            coins: 10
                        }
                    ],
                    // Quiz CP Histoire-Géographie - Vidéo 4
                    histgeo_cp_4: [
                        {
                            question: "Ma famille, c'est papa, maman et moi",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Les grands-parents sont :",
                            type: "qcm",
                            answers: ["Les parents de mes parents", "Mes frères", "Mes amis", "Mes voisins"],
                            correct: 0,
                            coins: 5
                        },
                        {
                            question: "Comment appelle-t-on le frère de papa ?",
                            type: "short",
                            correct: "oncle",
                            coins: 5
                        },
                        {
                            question: "Comment appelle-t-on la maman de maman ?",
                            type: "short",
                            correct: "grand-mère",
                            coins: 10
                        }
                    ],
                    // Quiz CP Histoire-Géographie - Vidéo 5
                    histgeo_cp_5: [
                        {
                            question: "L'école nous apprend à lire et à écrire",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Dans une école, il y a :",
                            type: "qcm",
                            answers: ["Des classes", "Des magasins", "Des voitures", "Des forêts"],
                            correct: 0,
                            coins: 5
                        },
                        {
                            question: "Qui nous enseigne à l'école ?",
                            type: "short",
                            correct: "le maître ou la maîtresse",
                            coins: 5
                        },
                        {
                            question: "Que faut-il respecter à l'école ?",
                            type: "short",
                            correct: "les règles",
                            coins: 10
                        }
                    ],
                    // Quiz CP Histoire-Géographie - Vidéo 6
                    histgeo_cp_6: [
                        {
                            question: "Il y a des villes et des villages",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Une ville a plus d'habitants qu'un village",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Où y a-t-il le plus de maisons ?",
                            type: "qcm",
                            answers: ["Au village", "En ville", "C'est pareil", "A la campagne"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Comment s'appelle un petit lieu avec peu de maisons ?",
                            type: "short",
                            correct: "village",
                            coins: 10
                        }
                    ],
                    // Quiz CP Histoire-Géographie - Vidéo 7
                    histgeo_cp_7: [
                        {
                            question: "Il faut respecter la nature",
                            type: "truefalse",
                            correct: true,
                            coins: 5
                        },
                        {
                            question: "Pour protéger la nature, on doit :",
                            type: "qcm",
                            answers: ["Jeter ses déchets par terre", "Jeter ses déchets à la poubelle", "Casser les arbres", "Salir les rivières"],
                            correct: 1,
                            coins: 5
                        },
                        {
                            question: "Où doit-on jeter ses déchets ?",
                            type: "short",
                            correct: "poubelle",
                            coins: 5
                        },
                        {
                            question: "Pourquoi faut-il trier ses déchets ?",
                            type: "qcm",
                            answers: ["Pour protéger la planète", "Pour faire joli", "Pour s'amuser", "Pour rien"],
                            correct: 0,
                            coins: 10
                        }
                    ]
                };
            }

            init() {
                this.setupEventListeners();
                this.animateOnLoad();
                this.updateProgressBars();
                this.startFloatingAnimation();
                this.updateDisplay();
            }
            
            initMobileMenuHandlers() {
                // Fermer le menu avec Escape
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape') {
                        const overlay = document.getElementById('mobileMenuOverlay');
                        if (overlay && overlay.classList.contains('menu-open')) {
                            toggleMobileMenu();
                        }
                    }
                });
                
                // Fermer le menu en cliquant à l'extérieur (sur le fond)
                document.addEventListener('touchstart', (e) => {
                    const overlay = document.getElementById('mobileMenuOverlay');
                    if (overlay && overlay.classList.contains('menu-open')) {
                        if (e.target === overlay) {
                            toggleMobileMenu();
                        }
                    }
                });
            }

            // Mettre à jour l'affichage des pièces et XP
            updateCoinAndXpDisplay() {
                const coinCounter = document.getElementById('coinCounter');
                if (coinCounter) {
                    coinCounter.textContent = this.coins;
                }
                
                // Mettre à jour l'affichage XP s'il existe
                const xpDisplay = document.getElementById('xpDisplay');
                if (xpDisplay) {
                    xpDisplay.textContent = `⭐${this.xp} 🏆${this.level}`;
                }
            }

            updateDisplay() {
                // Mettre à jour le nom et les pièces
                this.updateCoinAndXpDisplay();
                document.getElementById('studentName').textContent = this.studentName;
                
                // Mettre à jour l'avatar du personnage
                this.updateCharacterAvatar(this.currentCharacter);
                
                // Mettre à jour la classe sélectionnée
                document.getElementById('selectedClass').textContent = this.selectedClass.toUpperCase();
                
                // Mettre à jour les étoiles sur les cartes
                this.updateStarsOnCards();
            }

            updateStarsOnCards() {
                // Mettre à jour les barres de progrès sur les cartes
                this.updateProgressBars();
            }

            setupEventListeners() {
                // Coin counter interaction - animation seulement, pas d'ajout de pièces
                const coinCounter = document.getElementById('coinCounter');
                coinCounter.addEventListener('click', () => this.animateCoinsDisplay());
                
                // XP display interaction - animation pour l'XP
                const xpDisplay = document.getElementById('xpDisplay');
                if (xpDisplay) {
                    xpDisplay.addEventListener('click', () => this.animateXpDisplay());
                }

                // Subject cards - utiliser un sélecteur plus spécifique
                const subjectCards = document.querySelectorAll('.hover-zoom.cursor-pointer');
                subjectCards.forEach((card, index) => {
                    card.addEventListener('click', () => this.openSubject(card, index));
                    card.addEventListener('mouseenter', () => this.cardHoverEffect(card));
                });

                // Shop button (removed, now handled by navigation)
                
                // Daily bonus
                const bonusButton = document.querySelector('button i.fa-gift');
                if (bonusButton) {
                    bonusButton.parentElement.addEventListener('click', () => this.claimDailyBonus());
                }

                // Character avatar
                const avatar = document.getElementById('characterAvatar');
                if (avatar) {
                    avatar.addEventListener('click', () => this.animateCharacter());
                }
            }

            animateOnLoad() {
                // Staggered animation for subject cards
                const cards = document.querySelectorAll('.hover-zoom.cursor-pointer');
                cards.forEach((card, index) => {
                    setTimeout(() => {
                        card.style.opacity = '0';
                        card.style.transform = 'translateY(50px)';
                        card.style.transition = 'all 0.6s ease';
                        setTimeout(() => {
                            card.style.opacity = '1';
                            card.style.transform = 'translateY(0)';
                        }, 100);
                    }, index * 150);
                });

                // Welcome message animation
                const welcome = document.querySelector('h2');
                welcome.classList.add('slide-in-left');

                // Avatar bounce
                const avatar = document.getElementById('characterAvatar');
                avatar.classList.add('floating');
            }

            // Calculer le niveau basé sur l'XP
            calculateLevel(xp) {
                return Math.floor(xp / 100) + 1; // 100 XP par niveau
            }

            // Ajouter XP et mettre à jour le niveau
            addXP(amount) {
                const oldLevel = this.level;
                this.xp += amount;
                this.level = this.calculateLevel(this.xp);
                
                // Animation XP gagnée
                const xpDisplay = document.getElementById('xpDisplay');
                if (xpDisplay && amount > 0) {
                    xpDisplay.style.transform = 'scale(1.15)';
                    xpDisplay.style.color = '#3B82F6';
                    this.createFloatingText(`+${amount}⭐`, xpDisplay, '#3B82F6', 60);
                    
                    setTimeout(() => {
                        xpDisplay.style.transform = 'scale(1)';
                        xpDisplay.style.color = '';
                    }, 400);
                }
                
                // Vérifier si le joueur a monté de niveau
                if (this.level > oldLevel) {
                    this.showNotification(`🎉 NIVEAU SUPÉRIEUR! Tu es maintenant 🏆${this.level}! +50 pièces bonus! 🎉`);
                    this.coins += 50;
                    
                    // Animation spéciale niveau supérieur
                    if (xpDisplay) {
                        xpDisplay.style.animation = 'bounce 0.6s ease-in-out';
                        setTimeout(() => xpDisplay.style.animation = '', 600);
                    }
                    
                    this.updateCoinAndXpDisplay();
                }
                
                this.saveGameData();
            }

            animateCoins(amount = 10, xpAmount = 5) {
                const coinCounter = document.getElementById('coinCounter');
                const coinIcon = coinCounter.previousElementSibling;
                
                coinCounter.style.transform = 'scale(1.2)';
                coinIcon.style.transform = 'rotateY(360deg)';
                
                // Create floating effects
                this.createFloatingText(`+${amount}💰`, coinCounter, '#F59E0B');
                if (xpAmount > 0) {
                    this.createFloatingText(`+${xpAmount}⭐`, coinCounter, '#3B82F6', 50);
                }
                
                setTimeout(() => {
                    coinCounter.style.transform = 'scale(1)';
                    coinIcon.style.transform = 'rotateY(0deg)';
                }, 600);
                
                // Update counts
                this.coins += amount;
                if (xpAmount > 0) {
                    this.addXP(xpAmount);
                }
                
                setTimeout(() => {
                    this.updateCoinAndXpDisplay();
                }, 300);
            }

            animateCoinsDisplay() {
                const coinCounter = document.getElementById('coinCounter');
                const coinIcon = coinCounter.previousElementSibling;
                
                // Animation seulement, pas d'ajout de pièces
                coinCounter.style.transform = 'scale(1.2)';
                coinIcon.style.transform = 'rotateY(360deg)';
                
                setTimeout(() => {
                    coinCounter.style.transform = 'scale(1)';
                    coinIcon.style.transform = 'rotateY(0deg)';
                }, 600);
            }

            animateXpDisplay() {
                const xpDisplay = document.getElementById('xpDisplay');
                const xpIcon = xpDisplay.previousElementSibling;
                
                // Animation pour l'XP
                xpDisplay.style.transform = 'scale(1.2)';
                xpIcon.style.transform = 'rotateZ(360deg)';
                xpDisplay.style.color = '#FFD700';
                
                // Effet de brillance
                this.createFloatingText('✨⭐✨', xpDisplay, '#FFD700');
                
                setTimeout(() => {
                    xpDisplay.style.transform = 'scale(1)';
                    xpIcon.style.transform = 'rotateZ(0deg)';
                    xpDisplay.style.color = '';
                }, 600);
            }

            cardHoverEffect(card) {
                // Add sparkle effect
                if (!card.classList.contains('sparkle')) {
                    card.classList.add('sparkle');
                    setTimeout(() => {
                        card.classList.remove('sparkle');
                    }, 2000);
                }
            }

            openSubject(card, index) {
                const subjects = ['math', 'french', 'science', 'histgeo'];
                const subjectName = subjects[index];
                
                // Animation effect
                card.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    card.style.transform = 'scale(1)';
                }, 200);

                // Show modal or navigate
                this.showSubjectModal(subjectName);
                this.showNotification(`Ouverture de ${this.getSubjectDisplayName(subjectName)}...`);
            }

            showSubjectModal(subject) {
                const progress = Math.round(this.subjects[subject].progress);
                const modal = this.createModal(`
                    <div class="text-center max-w-md mx-auto">
                        <div class="mb-6">
                            <h3 class="text-2xl font-bold mb-4 gradient-text">
                                <i class="fas fa-graduation-cap mr-2"></i>
                                ${this.getSubjectDisplayName(subject)}
                            </h3>
                            
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-4 mb-4">
                                <p class="text-sm text-gray-600 mb-2">Ton progrès dans cette matière</p>
                                <div class="flex items-center justify-center gap-2 mb-2">
                                    <span class="text-2xl font-bold text-blue-600">${progress}%</span>
                                </div>
                                <div class="progress-bar mx-auto" style="width: 200px;">
                                    <div class="progress-fill" style="width: ${progress}%"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-bold mb-4 text-gray-800">🎯 Comment veux-tu apprendre ?</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="group bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl p-6 cursor-pointer hover:from-purple-200 hover:to-purple-300 transition-all duration-300 btn-bounce border-2 border-transparent hover:border-purple-300" onclick="showVideos('${subject}')">
                                    <div class="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">🎥</div>
                                    <h5 class="font-bold text-purple-800 mb-2">Vidéos</h5>
                                    <p class="text-sm text-purple-600">Apprends en regardant des vidéos</p>
                                </div>
                                <div class="group bg-gradient-to-br from-blue-100 to-blue-200 rounded-xl p-6 cursor-pointer hover:from-blue-200 hover:to-blue-300 transition-all duration-300 btn-bounce border-2 border-transparent hover:border-blue-300" onclick="startQuiz('${subject}')">
                                    <div class="text-4xl mb-3 group-hover:scale-110 transition-transform duration-300">❓</div>
                                    <h5 class="font-bold text-blue-800 mb-2">Quiz</h5>
                                    <p class="text-sm text-blue-600">Teste directement tes connaissances</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="border-t pt-4">
                            <button class="w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 btn-bounce" onclick="closeModal()">
                                <i class="fas fa-times mr-2"></i>Fermer
                            </button>
                        </div>
                    </div>
                `);
            }

            startLesson(subject) {
                this.closeModal();
                this.showNotification(`Lesson de ${this.getSubjectDisplayName(subject)} commencee!`);
                // Simulate progress increase
                this.subjects[subject].progress = Math.min(100, this.subjects[subject].progress + 10);
                this.coins += 20;
                this.addXP(10); // 10 XP pour terminer une leçon
                this.updateCoinAndXpDisplay();
                this.updateQuestProgress('earn_coins', 'all', 20);
                this.updateQuestProgress('lesson_complete', subject);
            }

            openShop() {
                const shopModal = this.createModal(`
                    <h3 class="text-2xl font-bold mb-4 gradient-text">Boutique de Personnages</h3>
                    <div class="max-h-96 overflow-y-auto mb-4">
                        <div class="mb-6">
                            <h4 class="text-lg font-bold mb-3 text-green-600">💰 Économiques (100-300 pièces)</h4>
                            <div class="grid grid-cols-3 gap-2 mb-4">
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('mouse', 100)">
                                    <div class="text-3xl mb-1">🐭</div>
                                    <p class="text-xs font-bold">Souris</p>
                                    <p class="text-xs text-yellow-600">100 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('frog', 150)">
                                    <div class="text-3xl mb-1">🐸</div>
                                    <p class="text-xs font-bold">Grenouille</p>
                                    <p class="text-xs text-yellow-600">150 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('fish', 200)">
                                    <div class="text-3xl mb-1">🐟</div>
                                    <p class="text-xs font-bold">Poisson</p>
                                    <p class="text-xs text-yellow-600">200 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('bird', 250)">
                                    <div class="text-3xl mb-1">🐦</div>
                                    <p class="text-xs font-bold">Oiseau</p>
                                    <p class="text-xs text-yellow-600">250 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('rabbit', 300)">
                                    <div class="text-3xl mb-1">🐰</div>
                                    <p class="text-xs font-bold">Lapin</p>
                                    <p class="text-xs text-yellow-600">300 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('turtle', 30)">
                                    <div class="text-3xl mb-1">🐢</div>
                                    <p class="text-xs font-bold">Tortue</p>
                                    <p class="text-xs text-yellow-600">30 pièces</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-bold mb-3 text-blue-600">🌟 Populaires (400-800 pièces)</h4>
                            <div class="grid grid-cols-3 gap-2 mb-4">
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('cat', 400)">
                                    <div class="text-3xl mb-1">🐱</div>
                                    <p class="text-xs font-bold">Chat</p>
                                    <p class="text-xs text-yellow-600">400 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('dog', 450)">
                                    <div class="text-3xl mb-1">🐶</div>
                                    <p class="text-xs font-bold">Chien</p>
                                    <p class="text-xs text-yellow-600">450 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('panda', 500)">
                                    <div class="text-3xl mb-1">🐼</div>
                                    <p class="text-xs font-bold">Panda</p>
                                    <p class="text-xs text-yellow-600">500 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('penguin', 550)">
                                    <div class="text-3xl mb-1">🐧</div>
                                    <p class="text-xs font-bold">Pingouin</p>
                                    <p class="text-xs text-yellow-600">550 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('koala', 600)">
                                    <div class="text-3xl mb-1">🐨</div>
                                    <p class="text-xs font-bold">Koala</p>
                                    <p class="text-xs text-yellow-600">600 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('elephant', 700)">
                                    <div class="text-3xl mb-1">🐘</div>
                                    <p class="text-xs font-bold">Éléphant</p>
                                    <p class="text-xs text-yellow-600">700 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('lion', 750)">
                                    <div class="text-3xl mb-1">🦁</div>
                                    <p class="text-xs font-bold">Lion</p>
                                    <p class="text-xs text-yellow-600">750 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('tiger', 800)">
                                    <div class="text-3xl mb-1">🐅</div>
                                    <p class="text-xs font-bold">Tigre</p>
                                    <p class="text-xs text-yellow-600">800 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('monkey', 650)">
                                    <div class="text-3xl mb-1">🐵</div>
                                    <p class="text-xs font-bold">Singe</p>
                                    <p class="text-xs text-yellow-600">650 pièces</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-bold mb-3 text-purple-600">✨ Spéciaux (900-1500 pièces)</h4>
                            <div class="grid grid-cols-3 gap-2 mb-4">
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('fox', 900)">
                                    <div class="text-3xl mb-1">🦊</div>
                                    <p class="text-xs font-bold">Renard</p>
                                    <p class="text-xs text-yellow-600">900 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('wolf', 1000)">
                                    <div class="text-3xl mb-1">🐺</div>
                                    <p class="text-xs font-bold">Loup</p>
                                    <p class="text-xs text-yellow-600">1000 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('eagle', 1100)">
                                    <div class="text-3xl mb-1">🦅</div>
                                    <p class="text-xs font-bold">Aigle</p>
                                    <p class="text-xs text-yellow-600">1100 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('owl', 1200)">
                                    <div class="text-3xl mb-1">🦉</div>
                                    <p class="text-xs font-bold">Hibou</p>
                                    <p class="text-xs text-yellow-600">1200 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('shark', 1300)">
                                    <div class="text-3xl mb-1">🦈</div>
                                    <p class="text-xs font-bold">Requin</p>
                                    <p class="text-xs text-yellow-600">1300 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('octopus', 1400)">
                                    <div class="text-3xl mb-1">🐙</div>
                                    <p class="text-xs font-bold">Pieuvre</p>
                                    <p class="text-xs text-yellow-600">1400 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('whale', 1500)">
                                    <div class="text-3xl mb-1">🐋</div>
                                    <p class="text-xs font-bold">Baleine</p>
                                    <p class="text-xs text-yellow-600">1500 pièces</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-bold mb-3 text-orange-600">🎁 Coffres mystères (500 pièces)</h4>
                            <div class="grid grid-cols-1 gap-2 mb-4">
                                <div class="text-center p-4 border-2 border-orange-400 rounded-lg hover:bg-orange-50 cursor-pointer bg-gradient-to-r from-orange-100 to-yellow-100" onclick="buyMysteryBox()">
                                    <div class="text-4xl mb-2">📦</div>
                                    <p class="text-sm font-bold text-orange-800">Coffre Mystère</p>
                                    <p class="text-xs text-orange-600 mb-2">500 pièces</p>
                                    <p class="text-xs text-gray-600">Contient un personnage aléatoire !</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="text-lg font-bold mb-3 text-red-600">🔥 Légendaires (2000-5000 pièces)</h4>
                            <div class="grid grid-cols-3 gap-2">
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('dragon', 2000)">
                                    <div class="text-3xl mb-1">🐉</div>
                                    <p class="text-xs font-bold">Dragon</p>
                                    <p class="text-xs text-yellow-600">2000 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('unicorn', 2500)">
                                    <div class="text-3xl mb-1">🦄</div>
                                    <p class="text-xs font-bold">Licorne</p>
                                    <p class="text-xs text-yellow-600">2500 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('phoenix', 3000)">
                                    <div class="text-3xl mb-1">🔥</div>
                                    <p class="text-xs font-bold">Phénix</p>
                                    <p class="text-xs text-yellow-600">3000 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('rainbow', 4000)">
                                    <div class="text-3xl mb-1">🌈</div>
                                    <p class="text-xs font-bold">Arc-en-ciel</p>
                                    <p class="text-xs text-yellow-600">4000 pièces</p>
                                </div>
                                <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer" onclick="buyCharacter('star', 5000)">
                                    <div class="text-3xl mb-1">⭐</div>
                                    <p class="text-xs font-bold">Étoile</p>
                                    <p class="text-xs text-yellow-600">5000 pièces</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="border-t pt-4">
                        <p class="text-center mb-4">Tes pièces: <span class="font-bold text-yellow-600">${this.coins}</span></p>
                        <button class="w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 btn-bounce" onclick="closeModal()">Fermer</button>
                    </div>
                `);
            }

            buyCharacter(character, cost) {
                if (this.coins >= cost) {
                    this.coins -= cost;
                    this.updateCoinAndXpDisplay();
                    this.currentCharacter = character;
                    
                    // Ajouter le personnage à l'inventaire s'il n'y est pas déjà
                    if (!this.inventory.includes(character)) {
                        this.inventory.push(character);
                    }
                    
                    this.updateCharacterAvatar(character);
                    this.saveGameData();
                    
                    // Debug pour vérifier la sauvegarde
                    console.log('🎮 Achat personnage:', character);
                    console.log('💰 Pièces restantes:', this.coins);
                    console.log('🎒 Inventaire:', this.inventory);
                    
                    this.closeModal();
                    
                    // Afficher la page spéciale de confirmation
                    this.showCharacterUnlockPage(character, cost, false);
                } else {
                    this.showNotification(`💰 Pas assez de pièces ! Il te faut ${cost - this.coins} pièces de plus. 😔`);
                }
            }

            buyMysteryBox() {
                const cost = 500;
                if (this.coins >= cost) {
                    this.coins -= cost;
                    this.updateCoinAndXpDisplay();
                    
                    // Liste de tous les personnages disponibles
                    const allCharacters = [
                        // Économiques
                        'mouse', 'frog', 'fish', 'bird', 'rabbit', 'turtle',
                        // Populaires  
                        'cat', 'dog', 'panda', 'penguin', 'koala', 'elephant', 'lion', 'tiger', 'monkey',
                        // Spéciaux
                        'fox', 'wolf', 'eagle', 'owl', 'shark', 'octopus', 'whale',
                        // Légendaires
                        'dragon', 'unicorn', 'phoenix', 'rainbow', 'star'
                    ];
                    
                    // Sélectionner un personnage aléatoire
                    const randomCharacter = allCharacters[Math.floor(Math.random() * allCharacters.length)];
                    
                    // Ajouter le personnage à l'inventaire s'il n'y est pas déjà
                    if (!this.inventory.includes(randomCharacter)) {
                        this.inventory.push(randomCharacter);
                    }
                    
                    this.saveGameData();
                    this.closeModal();
                    
                    // Afficher la page spéciale de confirmation pour coffre mystère
                    this.showCharacterUnlockPage(randomCharacter, cost, true);
                } else {
                    this.showNotification(`💰 Pas assez de pièces ! Il te faut ${cost - this.coins} pièces de plus. 😔`);
                }
            }

            getCharacterName(character) {
                const names = {
                    mouse: 'Souris 🐭', frog: 'Grenouille 🐸', fish: 'Poisson 🐟', 
                    bird: 'Oiseau 🐦', rabbit: 'Lapin 🐰', turtle: 'Tortue 🐢',
                    cat: 'Chat 🐱', dog: 'Chien 🐶', panda: 'Panda 🐼', 
                    penguin: 'Pingouin 🐧', koala: 'Koala 🐨', elephant: 'Éléphant 🐘', 
                    lion: 'Lion 🦁', tiger: 'Tigre 🐅', monkey: 'Singe 🐵',
                    fox: 'Renard 🦊', wolf: 'Loup 🐺', eagle: 'Aigle 🦅', 
                    owl: 'Hibou 🦉', shark: 'Requin 🦈', octopus: 'Pieuvre 🐙', whale: 'Baleine 🐋',
                    dragon: 'Dragon 🐉', unicorn: 'Licorne 🦄', phoenix: 'Phénix 🔥', 
                    rainbow: 'Arc-en-ciel 🌈', star: 'Étoile ⭐'
                };
                return names[character] || character;
            }

            showCharacterUnlockPage(character, cost, isFromMysteryBox = false) {
                // Créer la page de déblocage en plein écran
                const unlockPage = document.createElement('div');
                unlockPage.className = 'character-unlock-page';
                unlockPage.innerHTML = `
                    <div class="unlock-content">
                        <div class="unlock-background">
                            <div class="sparkle-container">
                                ${[...Array(20)].map(() => '<div class="sparkle"></div>').join('')}
                            </div>
                            <div class="unlock-header">
                                <h1 class="unlock-title">${isFromMysteryBox ? '🎁 COFFRE MYSTÈRE !' : '🎉 NOUVEAU PERSONNAGE !'}</h1>
                                <p class="unlock-subtitle">${isFromMysteryBox ? 'Tu as reçu...' : 'Félicitations !'}</p>
                            </div>
                            <div class="character-showcase">
                                <div class="character-circle">
                                    <div class="character-icon">${this.getCharacterIcon(character)}</div>
                                </div>
                                <div class="character-info">
                                    <h2 class="character-name">${this.getCharacterName(character).replace(/[^\w\s]/gi, '')}</h2>
                                    <p class="character-description">${isFromMysteryBox ? 'Obtenu par coffre mystère !' : `Acheté pour ${cost} pièces`}</p>
                                </div>
                            </div>
                            <div class="unlock-actions">
                                <button class="unlock-btn-primary" onclick="window.platform.closeCharacterUnlockPage()">
                                    ✨ Génial ! ✨
                                </button>
                            </div>
                        </div>
                    </div>
                `;

                // Ajouter les styles CSS pour la page
                const style = document.createElement('style');
                style.textContent = `
                    .character-unlock-page {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
                        z-index: 10000;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        animation: fadeInUnlock 0.8s ease-out;
                    }

                    .unlock-content {
                        text-align: center;
                        color: white;
                        max-width: 500px;
                        padding: 2rem;
                    }

                    .unlock-background {
                        position: relative;
                        background: rgba(255, 255, 255, 0.1);
                        backdrop-filter: blur(10px);
                        border-radius: 20px;
                        padding: 3rem 2rem;
                        border: 2px solid rgba(255, 255, 255, 0.2);
                    }

                    .sparkle-container {
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        pointer-events: none;
                        overflow: hidden;
                        border-radius: 20px;
                    }

                    .sparkle {
                        position: absolute;
                        width: 4px;
                        height: 4px;
                        background: #fff;
                        border-radius: 50%;
                        animation: sparkleFloat 3s infinite linear;
                    }

                    .sparkle:nth-child(odd) {
                        animation-delay: -1s;
                        animation-duration: 2s;
                    }

                    .sparkle:nth-child(even) {
                        animation-delay: -2s;
                        animation-duration: 2.5s;
                    }

                    ${[...Array(20)].map((_, i) => `
                        .sparkle:nth-child(${i+1}) {
                            left: ${Math.random() * 100}%;
                            top: ${Math.random() * 100}%;
                            animation-delay: ${Math.random() * 3}s;
                        }
                    `).join('')}

                    .unlock-title {
                        font-size: 2.5rem;
                        font-weight: bold;
                        margin-bottom: 0.5rem;
                        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
                        animation: bounceIn 1s ease-out;
                    }

                    .unlock-subtitle {
                        font-size: 1.2rem;
                        margin-bottom: 2rem;
                        opacity: 0.9;
                        animation: fadeIn 1s ease-out 0.3s both;
                    }

                    .character-showcase {
                        margin: 2rem 0;
                        animation: scaleIn 1s ease-out 0.6s both;
                    }

                    .character-circle {
                        width: 150px;
                        height: 150px;
                        margin: 0 auto 1rem;
                        background: linear-gradient(45deg, #ffd700, #ffed4e);
                        border-radius: 50%;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        animation: pulse 2s infinite, rotateGlow 4s infinite linear;
                        box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
                    }

                    .character-icon {
                        font-size: 4rem;
                        animation: characterBounce 2s ease-in-out infinite;
                    }

                    .character-name {
                        font-size: 2rem;
                        font-weight: bold;
                        margin-bottom: 0.5rem;
                        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
                    }

                    .character-description {
                        font-size: 1.1rem;
                        opacity: 0.8;
                        margin-bottom: 2rem;
                    }

                    .unlock-btn-primary {
                        background: linear-gradient(45deg, #ff6b6b, #feca57);
                        color: white;
                        border: none;
                        padding: 1rem 2rem;
                        font-size: 1.3rem;
                        font-weight: bold;
                        border-radius: 50px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
                        animation: glowButton 2s ease-in-out infinite alternate;
                    }

                    .unlock-btn-primary:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 20px rgba(0,0,0,0.3);
                    }

                    @keyframes fadeInUnlock {
                        from { opacity: 0; transform: scale(0.8); }
                        to { opacity: 1; transform: scale(1); }
                    }

                    @keyframes sparkleFloat {
                        0% { transform: translateY(100px) rotate(0deg); opacity: 0; }
                        10% { opacity: 1; }
                        90% { opacity: 1; }
                        100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
                    }

                    @keyframes bounceIn {
                        0% { transform: scale(0.3); opacity: 0; }
                        50% { transform: scale(1.05); }
                        70% { transform: scale(0.9); }
                        100% { transform: scale(1); opacity: 1; }
                    }

                    @keyframes scaleIn {
                        from { transform: scale(0); opacity: 0; }
                        to { transform: scale(1); opacity: 1; }
                    }

                    @keyframes pulse {
                        0% { transform: scale(1); }
                        50% { transform: scale(1.05); }
                        100% { transform: scale(1); }
                    }

                    @keyframes rotateGlow {
                        from { box-shadow: 0 0 30px rgba(255, 215, 0, 0.6); }
                        50% { box-shadow: 0 0 40px rgba(255, 215, 0, 0.8); }
                        to { box-shadow: 0 0 30px rgba(255, 215, 0, 0.6); }
                    }

                    @keyframes characterBounce {
                        0%, 100% { transform: translateY(0); }
                        50% { transform: translateY(-10px); }
                    }

                    @keyframes glowButton {
                        from { box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4); }
                        to { box-shadow: 0 4px 25px rgba(255, 107, 107, 0.6); }
                    }

                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(20px); }
                        to { opacity: 1; transform: translateY(0); }
                    }

                    @keyframes fadeOut {
                        from { opacity: 1; transform: scale(1); }
                        to { opacity: 0; transform: scale(0.8); }
                    }
                `;

                document.head.appendChild(style);
                document.body.appendChild(unlockPage);

                // Jouer un son si possible (optionnel)
                this.playUnlockSound();
            }

            closeCharacterUnlockPage() {
                const unlockPage = document.querySelector('.character-unlock-page');
                if (unlockPage) {
                    unlockPage.style.animation = 'fadeOut 0.5s ease-in';
                    setTimeout(() => {
                        unlockPage.remove();
                        // Supprimer aussi le style ajouté
                        const unlockStyle = document.querySelector('style:last-child');
                        if (unlockStyle && unlockStyle.textContent.includes('character-unlock-page')) {
                            unlockStyle.remove();
                        }
                        // Sauvegarde supplémentaire après fermeture de la cinématique
                        this.saveGameData();
                        console.log('💾 Sauvegarde après cinématique');
                    }, 500);
                }
            }

            playUnlockSound() {
                // Créer un son de notification simple avec Web Audio API
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
                    oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.3);
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                } catch (e) {
                    // Si l'audio ne fonctionne pas, continuer sans son
                }
            }

            openInventory() {
                const inventoryContent = this.inventory.length > 0 ? 
                    this.inventory.map(character => {
                        const name = this.getCharacterName(character);
                        const icon = this.getCharacterIcon(character);
                        const isActive = this.currentCharacter === character;
                        return `
                            <div class="text-center p-3 border rounded-lg hover:bg-gray-50 cursor-pointer ${isActive ? 'bg-blue-100 border-blue-300' : ''}" onclick="selectCharacterFromInventory('${character}')">
                                <div class="text-3xl mb-1">${icon}</div>
                                <p class="text-xs font-bold">${name.replace(/[^\w\s]/gi, '')}</p>
                                ${isActive ? '<p class="text-xs text-blue-600">Équipé</p>' : '<p class="text-xs text-gray-500">Cliquer pour équiper</p>'}
                            </div>
                        `;
                    }).join('') 
                    : '<p class="text-center text-gray-500">Votre inventaire est vide. Achetez des personnages dans la boutique !</p>';

                const inventoryModal = this.createModal(`
                    <h3 class="text-2xl font-bold mb-4 gradient-text">Mon Inventaire</h3>
                    <div class="max-h-96 overflow-y-auto mb-4">
                        <div class="grid grid-cols-3 gap-2">
                            ${inventoryContent}
                        </div>
                    </div>
                    <div class="border-t pt-4">
                        <p class="text-center mb-4">Personnages possédés: <span class="font-bold text-purple-600">${this.inventory.length}</span></p>
                        <button class="w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 btn-bounce" onclick="closeModal()">Fermer</button>
                    </div>
                `);
            }

            getCharacterIcon(character) {
                const icons = {
                    robot: '🤖',
                    mouse: '🐭', frog: '🐸', fish: '🐟', bird: '🐦', rabbit: '🐰', turtle: '🐢',
                    cat: '🐱', dog: '🐶', panda: '🐼', penguin: '🐧', koala: '🐨', elephant: '🐘', 
                    lion: '🦁', tiger: '🐅', monkey: '🐵',
                    fox: '🦊', wolf: '🐺', eagle: '🦅', owl: '🦉', shark: '🦈', octopus: '🐙', whale: '🐋',
                    dragon: '🐉', unicorn: '🦄', phoenix: '🔥', rainbow: '🌈', star: '⭐'
                };
                return icons[character] || '❓';
            }

            selectCharacterFromInventory(character) {
                this.currentCharacter = character;
                this.updateCharacterAvatar(character);
                this.saveGameData();
                this.closeModal();
                this.showNotification(`✨ Personnage ${this.getCharacterName(character)} équipé !`);
            }

            openQuests() {
                // Générer les quêtes quotidiennes si nécessaire
                this.generateDailyQuests();
                
                const questModal = this.createModal(`
                    <div class="quest-page-container">
                        <div class="quest-page-content">
                            <div class="quest-header mb-4">
                                <h3 class="text-2xl font-bold gradient-text">🗡️ Centre des Quêtes</h3>
                                <div class="chapter-badge">
                                    <span class="chapter-text">Chapitre ${this.currentChapter}</span>
                                    ${this.currentChapter >= 2 ? '<span class="chapter-unlock-badge">🌟 Débloqué</span>' : ''}
                                </div>
                            </div>
                            
                            <!-- Timeline des récompenses -->
                            <div class="timeline-container mb-6">
                                <h4 class="text-lg font-bold mb-3 text-blue-600">🏆 Progression (${this.questProgress} quêtes terminées)</h4>
                                <div class="timeline-scroll">
                                    ${this.generateTimeline()}
                                </div>
                            </div>
                            
                            <!-- Quêtes quotidiennes -->
                            <div class="daily-quests-container">
                                <h4 class="text-lg font-bold mb-3 text-green-600">📅 Quêtes Quotidiennes</h4>
                                <div class="quests-grid">
                                    ${this.generateQuestCards()}
                                </div>
                            </div>
                        </div>
                        
                        <div class="quest-footer">
                            <button class="w-full bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 btn-bounce" onclick="closeModal()">Fermer</button>
                        </div>
                    </div>
                `);
                
                // Ajouter les styles CSS pour les quêtes
                this.addQuestStyles();
            }

            generateDailyQuests() {
                const today = new Date().toDateString();
                
                console.log('🐛 Debug quêtes:', {
                    today: today,
                    lastQuestDate: this.lastQuestDate,
                    currentQuests: this.currentQuests.length,
                    questProgress: this.questProgress
                });
                
                // Si c'est un nouveau jour, générer de nouvelles quêtes
                if (this.lastQuestDate !== today) {
                    this.lastQuestDate = today;
                    this.currentQuests = [];
                    
                    // Déterminer le niveau basé sur l'âge
                    const level = this.getEducationLevel();
                    
                    // Générer 3 quêtes quotidiennes sans doublons
                    const questTemplates = this.getQuestTemplates(level);
                    
                    // Mélanger les quêtes et prendre les 3 premières (garantit pas de doublons)
                    const shuffledQuests = [...questTemplates].sort(() => Math.random() - 0.5);
                    const selectedQuests = shuffledQuests.slice(0, 3);
                    
                    selectedQuests.forEach((template, i) => {
                        this.currentQuests.push({
                            id: `quest_${today}_${i}`,
                            title: template.title,
                            description: template.description,
                            type: template.type,
                            subject: template.subject,
                            reward: template.reward,
                            completed: false,
                            progress: 0,
                            target: template.target || 1
                        });
                    });
                    
                    this.saveGameData();
                }
            }

            getEducationLevel() {
                // Si l'âge n'est pas défini, utiliser la classe sélectionnée
                if (!this.studentAge) {
                    const classMapping = {
                        'cp': 'CP',
                        'ce1': 'CE1', 
                        'ce2': 'CE2',
                        'cm1': 'CM1',
                        'cm2': 'CM2'
                    };
                    return classMapping[this.selectedClass] || 'CP';
                }
                
                // Déterminer le niveau basé sur l'âge
                if (this.studentAge <= 6) return 'CP';
                if (this.studentAge <= 7) return 'CE1';
                if (this.studentAge <= 8) return 'CE2';
                if (this.studentAge <= 9) return 'CM1';
                return 'CM2';
            }

            getQuestTemplates(level) {
                const templates = [
                    // Quêtes mathématiques
                    {
                        title: `📊 Maître des Nombres ${level}`,
                        description: `Complète un quiz de mathématiques niveau ${level}`,
                        type: 'quiz_complete',
                        subject: 'math',
                        reward: { coins: 25, xp: 10 },
                        target: 1
                    },
                    {
                        title: `🧮 Champion du Calcul`,
                        description: `Réponds correctement à 5 questions de mathématiques`,
                        type: 'correct_answers',
                        subject: 'math',
                        reward: { coins: 20, xp: 8 },
                        target: 5
                    },
                    {
                        title: `🔢 As des Chiffres`,
                        description: `Gagne des pièces en mathématiques`,
                        type: 'earn_coins',
                        subject: 'math',
                        reward: { coins: 15, xp: 5 },
                        target: 20
                    },
                    // Quêtes français
                    {
                        title: `📚 Lecteur Assidu ${level}`,
                        description: `Complète une leçon de français niveau ${level}`,
                        type: 'lesson_complete',
                        subject: 'french',
                        reward: { coins: 25, xp: 10 },
                        target: 1
                    },
                    {
                        title: `✍️ Maître des Mots`,
                        description: `Réponds correctement à 3 questions de français`,
                        type: 'correct_answers',
                        subject: 'french',
                        reward: { coins: 15, xp: 6 },
                        target: 3
                    },
                    {
                        title: `📖 Explorateur Littéraire`,
                        description: `Complète un quiz de français parfait`,
                        type: 'perfect_quizzes',
                        subject: 'french',
                        reward: { coins: 30, xp: 12 },
                        target: 1
                    },
                    // Quêtes générales
                    {
                        title: `🎯 Collectionneur de Pièces`,
                        description: `Gagne 30 pièces en jouant`,
                        type: 'earn_coins',
                        subject: 'all',
                        reward: { coins: 10, character: 'random' },
                        target: 30
                    },
                    {
                        title: `🌟 Élève Modèle`,
                        description: `Complète 2 quiz sans erreur`,
                        type: 'perfect_quizzes',
                        subject: 'all',
                        reward: { coins: 35, xp: 15 },
                        target: 2
                    },
                    {
                        title: `⚡ Éclair de Génie`,
                        description: `Réponds correctement à 8 questions`,
                        type: 'correct_answers',
                        subject: 'all',
                        reward: { coins: 25, xp: 10 },
                        target: 8
                    },
                    {
                        title: `🏆 Chasseur de Trésor`,
                        description: `Gagne 50 pièces aujourd'hui`,
                        type: 'earn_coins',
                        subject: 'all',
                        reward: { coins: 20, character: 'random' },
                        target: 50
                    },
                    {
                        title: `📝 Studieux du Jour`,
                        description: `Complète 2 leçons`,
                        type: 'lesson_complete',
                        subject: 'all',
                        reward: { coins: 30, xp: 12 },
                        target: 2
                    },
                    {
                        title: `💪 Persévérant`,
                        description: `Termine 2 quiz (même avec des erreurs)`,
                        type: 'quiz_complete',
                        subject: 'all',
                        reward: { coins: 20, xp: 8 },
                        target: 2
                    }
                ];
                
                return templates;
            }

            generateTimeline() {
                const milestones = [
                    { threshold: 0, reward: { coins: 0 }, unlocked: true },
                    { threshold: 1, reward: { coins: 50 }, unlocked: this.questProgress >= 1 },
                    { threshold: 3, reward: { coins: 100, character: 'mouse' }, unlocked: this.questProgress >= 3 },
                    { threshold: 5, reward: { coins: 150 }, unlocked: this.questProgress >= 5 },
                    { threshold: 10, reward: { coins: 200, character: 'cat' }, unlocked: this.questProgress >= 10 },
                    { threshold: 15, reward: { coins: 300 }, unlocked: this.questProgress >= 15 },
                    { threshold: 20, reward: { coins: 500, character: 'dragon' }, unlocked: this.questProgress >= 20 }
                ];
                
                return milestones.map((milestone, index) => {
                    const isUnlocked = milestone.unlocked;
                    const isCurrent = this.questProgress === milestone.threshold;
                    const isPassed = this.questProgress > milestone.threshold;
                    
                    let chestClass = 'chest-locked';
                    let chestIcon = '🔒';
                    
                    if (isPassed) {
                        chestClass = 'chest-completed';
                        chestIcon = '✅';
                    } else if (isUnlocked || isCurrent) {
                        chestClass = 'chest-available';
                        chestIcon = '📦';
                    }
                    
                    return `
                        <div class="timeline-item ${chestClass}">
                            <div class="chest-container" onclick="claimTimelineReward(${index})">
                                <div class="chest-icon">${chestIcon}</div>
                                <div class="chest-progress">${milestone.threshold}</div>
                            </div>
                            <div class="reward-info">
                                ${milestone.reward.coins ? `💰 ${milestone.reward.coins}` : ''}
                                ${milestone.reward.character ? `🎭 ${milestone.reward.character}` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            }

            generateQuestCards() {
                if (this.currentQuests.length === 0) {
                    return '<p class="text-center text-gray-500">Aucune quête disponible aujourd\'hui.</p>';
                }
                
                return this.currentQuests.map((quest, index) => {
                    const progressPercent = (quest.progress / quest.target) * 100;
                    const isCompleted = quest.completed;
                    
                    return `
                        <div class="quest-card ${isCompleted ? 'quest-completed' : ''}">
                            <div class="quest-header">
                                <h5 class="quest-title">${quest.title}</h5>
                                <div class="quest-reward">
                                    ${quest.reward.coins ? `💰 ${quest.reward.coins}` : ''}
                                    ${quest.reward.xp ? `⭐ ${quest.reward.xp} XP` : ''}
                                    ${quest.reward.character ? `🎭 ${quest.reward.character}` : ''}
                                </div>
                            </div>
                            <p class="quest-description">${quest.description}</p>
                            <div class="quest-progress">
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: ${progressPercent}%"></div>
                                </div>
                                <span class="progress-text">${quest.progress}/${quest.target}</span>
                            </div>
                            <div class="quest-actions">
                                ${isCompleted ? 
                                    '<button class="quest-btn quest-btn-completed" disabled>✅ Terminé</button>' :
                                    `<button class="quest-btn quest-btn-start" onclick="startQuest(${index})">🚀 ${progressPercent > 0 ? 'Continuer' : 'Commencer'}</button>`
                                }
                            </div>
                        </div>
                    `;
                }).join('');
            }

            addQuestStyles() {
                if (document.getElementById('quest-styles')) return;
                
                const style = document.createElement('style');
                style.id = 'quest-styles';
                style.textContent = `
                    .quest-page-container {
                        max-width: 900px;
                        margin: 0 auto;
                        max-height: 80vh;
                        display: flex;
                        flex-direction: column;
                    }
                    
                    .quest-page-content {
                        flex: 1;
                        overflow-y: auto;
                        padding-right: 10px;
                        scrollbar-width: thin;
                        scrollbar-color: #cbd5e0 transparent;
                    }
                    
                    .quest-page-content::-webkit-scrollbar {
                        width: 6px;
                    }
                    
                    .quest-page-content::-webkit-scrollbar-track {
                        background: transparent;
                    }
                    
                    .quest-page-content::-webkit-scrollbar-thumb {
                        background: #cbd5e0;
                        border-radius: 3px;
                    }
                    
                    .quest-page-content::-webkit-scrollbar-thumb:hover {
                        background: #a0aec0;
                    }
                    
                    .quest-footer {
                        flex-shrink: 0;
                        border-top: 1px solid #e2e8f0;
                        padding-top: 16px;
                        margin-top: 16px;
                        background: white;
                    }
                    
                    .quest-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        flex-wrap: wrap;
                        gap: 1rem;
                    }
                    
                    .chapter-badge {
                        display: flex;
                        align-items: center;
                        gap: 0.5rem;
                        background: linear-gradient(135deg, #667eea, #764ba2);
                        color: white;
                        padding: 0.5rem 1rem;
                        border-radius: 20px;
                        font-size: 0.9rem;
                        font-weight: bold;
                        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
                    }
                    
                    .chapter-text {
                        font-size: 1rem;
                    }
                    
                    .chapter-unlock-badge {
                        background: rgba(255, 215, 0, 0.2);
                        border: 1px solid rgba(255, 215, 0, 0.5);
                        border-radius: 12px;
                        padding: 0.2rem 0.5rem;
                        font-size: 0.8rem;
                        animation: glow-badge 2s ease-in-out infinite alternate;
                    }
                    
                    @keyframes glow-badge {
                        from { box-shadow: 0 0 5px rgba(255, 215, 0, 0.3); }
                        to { box-shadow: 0 0 15px rgba(255, 215, 0, 0.6); }
                    }
                    
                    .timeline-container {
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        border-radius: 15px;
                        padding: 20px;
                        color: white;
                    }
                    
                    .timeline-scroll {
                        display: flex;
                        overflow-x: auto;
                        gap: 20px;
                        padding: 10px 0;
                        scrollbar-width: thin;
                    }
                    
                    .timeline-scroll::-webkit-scrollbar {
                        height: 6px;
                    }
                    
                    .timeline-scroll::-webkit-scrollbar-track {
                        background: rgba(255,255,255,0.1);
                        border-radius: 3px;
                    }
                    
                    .timeline-scroll::-webkit-scrollbar-thumb {
                        background: rgba(255,255,255,0.3);
                        border-radius: 3px;
                    }
                    
                    .timeline-item {
                        flex-shrink: 0;
                        text-align: center;
                        min-width: 100px;
                    }
                    
                    .chest-container {
                        cursor: pointer;
                        transition: transform 0.3s ease;
                        padding: 10px;
                        border-radius: 10px;
                        margin-bottom: 5px;
                    }
                    
                    .chest-container:hover {
                        transform: scale(1.1);
                    }
                    
                    .chest-icon {
                        font-size: 2rem;
                        margin-bottom: 5px;
                    }
                    
                    .chest-progress {
                        font-weight: bold;
                        font-size: 14px;
                    }
                    
                    .chest-available {
                        background: rgba(255,215,0,0.2);
                        border: 2px solid #ffd700;
                    }
                    
                    .chest-completed {
                        background: rgba(34,197,94,0.2);
                        border: 2px solid #22c55e;
                    }
                    
                    .chest-locked {
                        background: rgba(107,114,128,0.2);
                        border: 2px solid #6b7280;
                        opacity: 0.6;
                    }
                    
                    .reward-info {
                        font-size: 12px;
                        opacity: 0.9;
                    }
                    
                    .daily-quests-container {
                        background: #f8fafc;
                        border-radius: 15px;
                        padding: 20px;
                    }
                    
                    .quests-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                        gap: 20px;
                    }
                    
                    .quest-card {
                        background: white;
                        border: 2px solid #e2e8f0;
                        border-radius: 12px;
                        padding: 20px;
                        transition: all 0.3s ease;
                        position: relative;
                    }
                    
                    .quest-card:hover {
                        border-color: #3b82f6;
                        transform: translateY(-2px);
                        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                    }
                    
                    .quest-completed {
                        background: #f0fdf4;
                        border-color: #22c55e;
                    }
                    
                    .quest-completed::after {
                        content: '✅';
                        position: absolute;
                        top: 10px;
                        right: 10px;
                        font-size: 1.5rem;
                    }
                    
                    .quest-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        margin-bottom: 10px;
                    }
                    
                    .quest-title {
                        font-size: 1.1rem;
                        font-weight: bold;
                        color: #1f2937;
                        margin: 0;
                        flex: 1;
                        margin-right: 10px;
                    }
                    
                    .quest-reward {
                        font-size: 0.9rem;
                        color: #f59e0b;
                        font-weight: bold;
                        white-space: nowrap;
                    }
                    
                    .quest-description {
                        color: #6b7280;
                        font-size: 0.9rem;
                        margin-bottom: 15px;
                        line-height: 1.4;
                    }
                    
                    .quest-progress {
                        margin-bottom: 15px;
                    }
                    
                    .progress-bar {
                        width: 100%;
                        height: 8px;
                        background: #e2e8f0;
                        border-radius: 4px;
                        overflow: hidden;
                        margin-bottom: 5px;
                    }
                    
                    .progress-fill {
                        height: 100%;
                        background: linear-gradient(90deg, #3b82f6, #1d4ed8);
                        transition: width 0.3s ease;
                        border-radius: 4px;
                    }
                    
                    .progress-text {
                        font-size: 0.8rem;
                        color: #6b7280;
                        font-weight: bold;
                    }
                    
                    .quest-actions {
                        text-align: center;
                    }
                    
                    .quest-btn {
                        padding: 10px 20px;
                        border: none;
                        border-radius: 8px;
                        font-weight: bold;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        min-width: 120px;
                    }
                    
                    .quest-btn-start {
                        background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                        color: white;
                    }
                    
                    .quest-btn-start:hover {
                        transform: translateY(-1px);
                        box-shadow: 0 4px 8px rgba(59,130,246,0.3);
                    }
                    
                    .quest-btn-completed {
                        background: #22c55e;
                        color: white;
                        opacity: 0.7;
                        cursor: not-allowed;
                    }
                    
                    @media (max-width: 640px) {
                        .quest-page-container {
                            max-height: 85vh;
                            margin: 0 10px;
                        }
                        
                        .quest-page-content {
                            padding-right: 5px;
                        }
                        
                        .quests-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        .timeline-scroll {
                            padding: 5px 0;
                        }
                        
                        .timeline-item {
                            min-width: 80px;
                        }
                        
                        .chest-icon {
                            font-size: 1.5rem;
                        }
                        
                        .timeline-container, .daily-quests-container {
                            margin-bottom: 20px;
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            startQuest(questIndex) {
                const quest = this.currentQuests[questIndex];
                if (!quest || quest.completed) return;
                
                this.closeModal();
                
                // Rediriger vers l'activité appropriée selon le type de quête
                switch (quest.type) {
                    case 'quiz_complete':
                    case 'correct_answers':
                        this.showNotification(`🎯 Quête "${quest.title}" activée ! Commence un quiz ${quest.subject === 'math' ? 'de mathématiques' : 'de français'} !`);
                        break;
                    case 'lesson_complete':
                        this.showNotification(`📚 Quête "${quest.title}" activée ! Commence une leçon !`);
                        break;
                    case 'earn_coins':
                        this.showNotification(`💰 Quête "${quest.title}" activée ! Gagne des pièces en jouant !`);
                        break;
                    case 'perfect_quizzes':
                        this.showNotification(`🌟 Quête "${quest.title}" activée ! Fais des quiz parfaits !`);
                        break;
                }
                
                this.saveGameData();
            }

            completeQuest(questIndex, reward) {
                const quest = this.currentQuests[questIndex];
                if (!quest || quest.completed) return;
                
                quest.completed = true;
                quest.progress = quest.target;
                this.questProgress++;
                
                // Donner les récompenses
                if (reward.coins) {
                    this.coins += reward.coins;
                    this.updateCoinAndXpDisplay();
                }
                if (reward.xp) {
                    this.addXP(reward.xp);
                }
                
                if (reward.character) {
                    if (reward.character === 'random') {
                        // Donner un personnage aléatoire
                        const characters = ['mouse', 'frog', 'fish', 'bird', 'rabbit', 'turtle'];
                        const randomChar = characters[Math.floor(Math.random() * characters.length)];
                        if (!this.inventory.includes(randomChar)) {
                            this.inventory.push(randomChar);
                            this.showCharacterUnlockPage(randomChar, 0, true);
                        }
                    } else if (!this.inventory.includes(reward.character)) {
                        this.inventory.push(reward.character);
                        this.showCharacterUnlockPage(reward.character, 0, true);
                    }
                }
                
                this.saveGameData();
                this.showNotification(`🎉 Quête "${quest.title}" terminée ! Récompenses obtenues !`);
            }

            claimTimelineReward(milestoneIndex) {
                const milestones = [
                    { threshold: 0, reward: { coins: 0 }, unlocked: true },
                    { threshold: 1, reward: { coins: 50 }, unlocked: this.questProgress >= 1 },
                    { threshold: 3, reward: { coins: 100, character: 'mouse' }, unlocked: this.questProgress >= 3 },
                    { threshold: 5, reward: { coins: 150 }, unlocked: this.questProgress >= 5 },
                    { threshold: 10, reward: { coins: 200, character: 'cat' }, unlocked: this.questProgress >= 10 },
                    { threshold: 15, reward: { coins: 300 }, unlocked: this.questProgress >= 15 },
                    { threshold: 20, reward: { coins: 500, character: 'dragon' }, unlocked: this.questProgress >= 20 }
                ];
                
                const milestone = milestones[milestoneIndex];
                if (!milestone || !milestone.unlocked || this.questProgress < milestone.threshold) {
                    this.showNotification('🔒 Cette récompense n\'est pas encore disponible !');
                    return;
                }
                
                // Vérifier si déjà réclamée
                if (!this.claimedRewards) this.claimedRewards = [];
                if (this.claimedRewards.includes(milestoneIndex)) {
                    this.showNotification('✅ Cette récompense a déjà été réclamée !');
                    return;
                }
                
                // Donner les récompenses
                if (milestone.reward.coins > 0) {
                    this.coins += milestone.reward.coins;
                    this.updateCoinAndXpDisplay();
                }
                if (milestone.reward.xp) {
                    this.addXP(milestone.reward.xp);
                }
                
                if (milestone.reward.character) {
                    if (!this.inventory.includes(milestone.reward.character)) {
                        this.inventory.push(milestone.reward.character);
                        this.showCharacterUnlockPage(milestone.reward.character, 0, true);
                    }
                }
                
                // Marquer comme réclamée
                this.claimedRewards.push(milestoneIndex);
                this.saveGameData();
                
                this.showNotification(`🏆 Récompense de palier réclamée ! ${milestone.reward.coins ? `+${milestone.reward.coins} pièces` : ''} ${milestone.reward.character ? `+${milestone.reward.character}` : ''}`);
                
                // Débloquer le Chapitre 2 si on récupère la récompense du coffre "20" (index 6)
                if (milestoneIndex === 6 && this.currentChapter === 1) {
                    this.currentChapter = 2;
                    this.unlockedChapters.push(2);
                    this.saveGameData();
                    
                    // Déclencher la cinématique du Chapitre 2 avec délai
                    setTimeout(() => {
                        this.showChapter2Cinematic();
                    }, 2000); // 2 secondes après avoir récupéré les récompenses
                }
            }

            updateQuestProgress(questType, subject, amount = 1) {
                if (!this.currentQuests || this.currentQuests.length === 0) return;
                
                let questCompleted = false;
                
                this.currentQuests.forEach((quest, index) => {
                    if (quest.completed) return;
                    
                    // Vérifier si cette quête correspond au type d'activité
                    if (quest.type === questType && (quest.subject === subject || quest.subject === 'all' || subject === 'all')) {
                        quest.progress = Math.min(quest.target, quest.progress + amount);
                        
                        // Vérifier si la quête est terminée
                        if (quest.progress >= quest.target && !quest.completed) {
                            quest.completed = true;
                            this.questProgress++;
                            questCompleted = true;
                            
                            // Donner les récompenses
                            if (quest.reward.coins) {
                                this.coins += quest.reward.coins;
                                this.updateCoinAndXpDisplay();
                            }
                            if (quest.reward.xp) {
                                this.addXP(quest.reward.xp);
                            }
                            
                            if (quest.reward.character) {
                                if (quest.reward.character === 'random') {
                                    const characters = ['mouse', 'frog', 'fish', 'bird', 'rabbit', 'turtle'];
                                    const randomChar = characters[Math.floor(Math.random() * characters.length)];
                                    if (!this.inventory.includes(randomChar)) {
                                        this.inventory.push(randomChar);
                                        setTimeout(() => {
                                            this.showCharacterUnlockPage(randomChar, 0, true);
                                        }, 1000);
                                    }
                                } else if (!this.inventory.includes(quest.reward.character)) {
                                    this.inventory.push(quest.reward.character);
                                    setTimeout(() => {
                                        this.showCharacterUnlockPage(quest.reward.character, 0, true);
                                    }, 1000);
                                }
                            }
                            
                            // Notification de quête terminée
                            setTimeout(() => {
                                this.showNotification(`🎯 Quête "${quest.title}" terminée ! ${quest.reward.coins ? `+${quest.reward.coins} pièces` : ''} ${quest.reward.xp ? `+${quest.reward.xp} XP` : ''} 🎉`);
                            }, 500);
                        }
                    }
                });
                
                if (questCompleted) {
                    this.saveGameData();
                }
            }

            checkChapterUnlock() {
                // Chapitre 2 à 20 quêtes (maintenant via timeline)
                if (this.questProgress >= 20 && this.currentChapter === 1) {
                    this.currentChapter = 2;
                    this.unlockedChapters.push(2);
                    this.saveGameData();
                    
                    // Déclencher la cinématique du chapitre 2 avec délai
                    setTimeout(() => {
                        this.showChapter2Cinematic();
                    }, 1500);
                }
                
                // Futurs chapitres...
                // Chapitre 3 à 50 quêtes, etc.
            }

            showChapter2Cinematic() {
                // Créer la cinématique en plein écran
                const cinematicPage = document.createElement('div');
                cinematicPage.className = 'chapter-cinematic';
                cinematicPage.innerHTML = `
                    <div class="cinematic-content">
                        <div class="stars-background">
                            ${[...Array(50)].map(() => '<div class="star"></div>').join('')}
                        </div>
                        <div class="cinematic-text-container">
                            <div class="chapter-announcement" id="chapterText">
                                <h1 class="cinematic-title">🏆 FÉLICITATIONS ! 🏆</h1>
                                <p class="cinematic-subtitle">Tu as terminé 20 quêtes avec brio !</p>
                                <div class="chapter-unlock">
                                    <div class="chapter-number">CHAPITRE 2</div>
                                    <div class="chapter-name">🌟 L'AVENTURE CONTINUE 🌟</div>
                                </div>
                                <div class="unlock-rewards">
                                    <p class="reward-text">🎁 Récompenses débloquées :</p>
                                    <ul class="rewards-list">
                                        <li>✨ Nouvelles quêtes plus challenging</li>
                                        <li>🏆 Récompenses améliorées</li>
                                        <li>🎭 Personnages légendaires accessibles</li>
                                        <li>💎 Badge "Maître Aventurier"</li>
                                    </ul>
                                </div>
                            </div>
                            <button class="cinematic-continue-btn" onclick="window.platform.closeCinematic()" id="continueBtn" style="opacity: 0;">
                                ✨ Continuer l'Aventure ✨
                            </button>
                        </div>
                    </div>
                `;

                // Ajouter les styles pour la cinématique
                const cinematicStyle = document.createElement('style');
                cinematicStyle.textContent = `
                    .chapter-cinematic {
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100vw;
                        height: 100vh;
                        background: linear-gradient(45deg, #1a1a2e, #16213e, #0f3460);
                        z-index: 20000;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        animation: cinematicFadeIn 1s ease-out;
                    }

                    .cinematic-content {
                        position: relative;
                        text-align: center;
                        color: white;
                        max-width: 800px;
                        padding: 2rem;
                    }

                    .stars-background {
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        overflow: hidden;
                        pointer-events: none;
                    }

                    .star {
                        position: absolute;
                        width: 2px;
                        height: 2px;
                        background: #fff;
                        border-radius: 50%;
                        animation: twinkle 2s infinite ease-in-out alternate;
                    }

                    ${[...Array(50)].map((_, i) => `
                        .star:nth-child(${i+1}) {
                            left: ${Math.random() * 100}%;
                            top: ${Math.random() * 100}%;
                            animation-delay: ${Math.random() * 2}s;
                            animation-duration: ${1.5 + Math.random() * 1}s;
                        }
                    `).join('')}

                    .cinematic-text-container {
                        position: relative;
                        z-index: 10;
                    }

                    .chapter-announcement {
                        animation: slideUpFade 1.5s ease-out 0.5s both;
                    }

                    .cinematic-title {
                        font-size: 3rem;
                        font-weight: bold;
                        margin-bottom: 1rem;
                        text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
                        background: linear-gradient(45deg, #ffd700, #ffed4e, #ff6b6b);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                        animation: glow 2s ease-in-out infinite alternate;
                    }

                    .cinematic-subtitle {
                        font-size: 1.3rem;
                        margin-bottom: 2rem;
                        opacity: 0.9;
                        animation: slideUpFade 1.5s ease-out 1s both;
                    }

                    .chapter-unlock {
                        margin: 3rem 0;
                        padding: 2rem;
                        background: rgba(255, 255, 255, 0.1);
                        backdrop-filter: blur(10px);
                        border-radius: 20px;
                        border: 2px solid rgba(255, 215, 0, 0.3);
                        animation: scaleIn 1s ease-out 1.5s both;
                    }

                    .chapter-number {
                        font-size: 4rem;
                        font-weight: bold;
                        background: linear-gradient(45deg, #ff6b6b, #feca57, #48cae4);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        background-clip: text;
                        margin-bottom: 0.5rem;
                        text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
                    }

                    .chapter-name {
                        font-size: 1.8rem;
                        font-weight: bold;
                        color: #ffd700;
                        text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
                    }

                    .unlock-rewards {
                        margin-top: 2rem;
                        animation: slideUpFade 1.5s ease-out 2s both;
                    }

                    .reward-text {
                        font-size: 1.2rem;
                        font-weight: bold;
                        margin-bottom: 1rem;
                        color: #48cae4;
                    }

                    .rewards-list {
                        list-style: none;
                        padding: 0;
                        text-align: left;
                        max-width: 500px;
                        margin: 0 auto;
                    }

                    .rewards-list li {
                        padding: 0.5rem 0;
                        font-size: 1.1rem;
                        opacity: 0;
                        animation: slideInLeft 0.8s ease-out both;
                    }

                    .rewards-list li:nth-child(1) { animation-delay: 2.5s; }
                    .rewards-list li:nth-child(2) { animation-delay: 2.8s; }
                    .rewards-list li:nth-child(3) { animation-delay: 3.1s; }
                    .rewards-list li:nth-child(4) { animation-delay: 3.4s; }

                    .cinematic-continue-btn {
                        background: linear-gradient(45deg, #ff6b6b, #feca57);
                        color: white;
                        border: none;
                        padding: 1rem 3rem;
                        font-size: 1.3rem;
                        font-weight: bold;
                        border-radius: 50px;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        margin-top: 2rem;
                        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
                        animation: fadeInUp 1s ease-out 4s both;
                    }

                    .cinematic-continue-btn:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
                    }

                    @keyframes cinematicFadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }

                    @keyframes slideUpFade {
                        from { opacity: 0; transform: translateY(50px); }
                        to { opacity: 1; transform: translateY(0); }
                    }

                    @keyframes scaleIn {
                        from { opacity: 0; transform: scale(0.5); }
                        to { opacity: 1; transform: scale(1); }
                    }

                    @keyframes slideInLeft {
                        from { opacity: 0; transform: translateX(-30px); }
                        to { opacity: 1; transform: translateX(0); }
                    }

                    @keyframes fadeInUp {
                        from { opacity: 0; transform: translateY(30px); }
                        to { opacity: 1; transform: translateY(0); }
                    }

                    @keyframes twinkle {
                        from { opacity: 0.3; }
                        to { opacity: 1; }
                    }

                    @keyframes glow {
                        from { filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5)); }
                        to { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); }
                    }

                    @media (max-width: 640px) {
                        .cinematic-title {
                            font-size: 2rem;
                        }
                        
                        .chapter-number {
                            font-size: 2.5rem;
                        }
                        
                        .chapter-name {
                            font-size: 1.3rem;
                        }
                        
                        .cinematic-content {
                            padding: 1rem;
                        }
                        
                        .chapter-unlock {
                            padding: 1rem;
                            margin: 2rem 0;
                        }
                    }
                `;

                document.head.appendChild(cinematicStyle);
                document.body.appendChild(cinematicPage);

                // Jouer un son épique
                this.playChapterUnlockSound();
            }

            closeCinematic() {
                const cinematic = document.querySelector('.chapter-cinematic');
                if (cinematic) {
                    cinematic.style.animation = 'cinematicFadeIn 0.5s ease-in reverse';
                    setTimeout(() => {
                        cinematic.remove();
                        // Supprimer aussi le style
                        const cinematicStyle = document.querySelector('style:last-child');
                        if (cinematicStyle) {
                            cinematicStyle.remove();
                        }
                    }, 500);
                }
            }

            playChapterUnlockSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // Mélodie épique pour déblocage de chapitre
                    const notes = [523.25, 659.25, 783.99, 1046.50]; // Do, Mi, Sol, Do (octave)
                    let noteIndex = 0;
                    
                    const playNote = (frequency, duration) => {
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                        oscillator.type = 'triangle';
                        
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + duration);
                        
                        return audioContext.currentTime + duration;
                    };
                    
                    // Jouer la mélodie
                    let time = audioContext.currentTime;
                    notes.forEach((note, index) => {
                        setTimeout(() => {
                            playNote(note, 0.5);
                        }, index * 200);
                    });
                    
                } catch (e) {
                    console.log('Audio not supported');
                }
            }

            updateCharacterAvatar(character) {
                const avatar = document.getElementById('characterAvatar');
                const icons = {
                    robot: 'fas fa-robot',
                    // Économiques
                    mouse: '🐭',
                    frog: '🐸',
                    fish: '🐟',
                    bird: '🐦',
                    rabbit: '🐰',
                    turtle: '🐢',
                    // Populaires
                    cat: '🐱',
                    dog: '🐶',
                    panda: '🐼',
                    penguin: '🐧',
                    koala: '🐨',
                    elephant: '🐘',
                    lion: '🦁',
                    tiger: '🐅',
                    monkey: '🐵',
                    // Spéciaux
                    fox: '🦊',
                    wolf: '🐺',
                    eagle: '🦅',
                    owl: '🦉',
                    shark: '🦈',
                    octopus: '🐙',
                    whale: '🐋',
                    // Légendaires
                    dragon: '🐉',
                    unicorn: '🦄',
                    phoenix: '🔥',
                    rainbow: '🌈',
                    star: '⭐'
                };
                
                if (character === 'robot') {
                    avatar.innerHTML = `<i class="${icons[character]}"></i>`;
                } else {
                    avatar.innerHTML = icons[character];
                    avatar.style.fontSize = '3rem';
                }
            }

            claimDailyBonus() {
                if (!this.dailyBonusClaimed) {
                    this.coins += 50;
                    this.addXP(20); // 20 XP pour le bonus quotidien
                    this.updateCoinAndXpDisplay();
                    this.dailyBonusClaimed = true;
                    this.showNotification('Bonus quotidien reçu! +50💰 +20⭐');
                    this.updateQuestProgress('earn_coins', 'all', 50);
                    
                    // Update button
                    const bonusButton = document.querySelector('button i.fa-gift').parentElement;
                    bonusButton.innerHTML = '<i class="fas fa-check mr-2"></i>Bonus Recu!';
                    bonusButton.disabled = true;
                    bonusButton.classList.add('opacity-50');
                } else {
                    this.showNotification('Bonus déjà reçu aujourd\'hui!');
                }
            }

            animateCharacter() {
                const avatar = document.getElementById('characterAvatar');
                avatar.style.animation = 'wiggle 0.5s ease-in-out';
                setTimeout(() => {
                    avatar.style.animation = 'float 3s ease-in-out infinite';
                }, 500);
            }

            startFloatingAnimation() {
                const elements = ['.hover-bounce', '.floating'];
                elements.forEach(selector => {
                    const element = document.querySelector(selector);
                    if (element) {
                        element.classList.add('floating');
                    }
                });
            }

            updateProgressBars() {
                // Mettre à jour les barres de progrès des matières
                Object.keys(this.subjects).forEach(subject => {
                    const progress = Math.round(this.subjects[subject].progress);
                    const progressText = document.getElementById(`${subject}-progress`);
                    const progressBar = document.getElementById(`${subject}-progress-bar`);
                    
                    if (progressText) {
                        progressText.textContent = progress;
                    }
                    if (progressBar) {
                        progressBar.style.width = progress + '%';
                    }
                });
            }

            createFloatingText(text, element, color, offsetX = 10) {
                // Limiter le nombre d'éléments flottants simultanés
                const existingFloating = document.querySelectorAll('.floating-text');
                if (existingFloating.length > 3) {
                    existingFloating.forEach(el => el.remove());
                }
                
                const floating = document.createElement('div');
                floating.textContent = text;
                floating.className = 'floating-text';
                floating.style.position = 'fixed'; // Utiliser fixed au lieu d'absolute
                floating.style.color = color;
                floating.style.fontWeight = 'bold';
                floating.style.pointerEvents = 'none';
                floating.style.zIndex = '1000';
                floating.style.animation = 'float 2s ease-out forwards';
                floating.style.fontSize = '16px';
                
                const rect = element.getBoundingClientRect();
                floating.style.left = rect.right + offsetX + 'px';
                floating.style.top = rect.top + 'px';
                
                document.body.appendChild(floating);
                
                // S'assurer que l'élément est supprimé même si l'animation échoue
                setTimeout(() => {
                    if (floating.parentNode) {
                        floating.parentNode.removeChild(floating);
                    }
                }, 2000);
                
                // Supprimer également à la fin de l'animation
                floating.addEventListener('animationend', () => {
                    if (floating.parentNode) {
                        floating.parentNode.removeChild(floating);
                    }
                });
            }

            createModal(content) {
                const modal = document.createElement('div');
                
                // Adaptation automatique selon l'appareil
                if (this.isMobile) {
                    modal.className = 'modal mobile-modal';
                    modal.innerHTML = `
                        <div class="modal-content mobile-modal-content">
                            <div class="mobile-modal-header">
                                <button onclick="this.closest('.modal').remove()" class="mobile-close-btn">×</button>
                            </div>
                            <div class="mobile-modal-body">
                                ${content}
                            </div>
                        </div>
                    `;
                } else {
                    modal.className = 'modal desktop-modal';
                    modal.innerHTML = `
                        <div class="modal-content desktop-modal-content">
                            ${content}
                        </div>
                    `;
                }
                
                modal.style.display = 'block';
                document.body.appendChild(modal);
                
                // Close on background click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        this.closeModal();
                    }
                });
                
                return modal;
            }

            closeModal() {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => modal.remove());
            }

            showVideos(subject) {
                this.closeModal();
                const classData = this.videoData[this.selectedClass] || {};
                const videos = classData[subject] || [];
                
                if (videos.length === 0) {
                    this.showNotification(`Aucune vidéo disponible pour ${this.getSubjectDisplayName(subject)} en ${this.selectedClass.toUpperCase()}`);
                    return;
                }
                
                const modal = this.createModal(`
                    <div class="text-center max-w-4xl mx-auto">
                        <div class="mb-6">
                            <h3 class="text-2xl font-bold mb-2 gradient-text">
                                🎥 ${this.getSubjectDisplayName(subject)} - Vidéos
                            </h3>
                            <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-lg p-3 mb-4">
                                <p class="text-sm text-gray-700">
                                    <span class="font-semibold">Classe ${this.selectedClass.toUpperCase()}</span> - 
                                    <span class="text-purple-600 font-medium">${videos.length} vidéo${videos.length > 1 ? 's' : ''} disponible${videos.length > 1 ? 's' : ''}</span>
                                </p>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold mb-4 text-gray-800">📚 Choisis une vidéo :</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
                                ${videos.map(video => `
                                    <div class="group bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1" onclick="watchVideo('${video.id}', '${subject}')">
                                        <div class="relative">
                                            <div class="w-full h-32 bg-gradient-to-br from-purple-200 to-pink-200 flex items-center justify-center">
                                                <div class="text-4xl">🎥</div>
                                            </div>
                                            <div class="absolute inset-0 bg-black bg-opacity-20 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                                                <div class="bg-red-500 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg transform scale-100 group-hover:scale-110 transition-transform duration-300">
                                                    <i class="fas fa-play"></i>
                                                </div>
                                            </div>
                                            <div class="absolute top-2 right-2 bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded-full">
                                                ${video.duration || '5 min'}
                                            </div>
                                        </div>
                                        <div class="p-4">
                                            <h5 class="font-bold text-sm mb-2 text-gray-800 line-clamp-2">${video.title}</h5>
                                            <p class="text-xs text-gray-600 mb-3 line-clamp-2">${video.description || 'Cliquez pour regarder cette vidéo interactive !'}</p>
                                            <div class="flex items-center justify-center">
                                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white py-2 px-3 rounded-lg text-xs font-bold flex items-center gap-1">
                                                    <i class="fas fa-play"></i>
                                                    Regarder
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="border-t pt-4">
                            <div class="flex gap-3 justify-center">
                                <button class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 btn-bounce" onclick="showSubjectModal('${subject}')">
                                    <i class="fas fa-arrow-left mr-2"></i>Retour à la matière
                                </button>
                                <button class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 btn-bounce" onclick="closeModal()">
                                    <i class="fas fa-times mr-2"></i>Fermer
                                </button>
                            </div>
                        </div>
                    </div>
                `);
            }

            watchVideo(videoId, subject) {
                this.closeModal();
                const classData = this.videoData[this.selectedClass] || {};
                const videos = classData[subject] || [];
                const video = videos.find(v => v.id === videoId);
                
                if (!video) return;
                
                this.currentVideo = { ...video, subject };
                
                // Afficher d'abord la vidéo
                const modal = this.createModal(`
                    <div class="text-center max-w-3xl mx-auto">
                        <h3 class="text-xl font-bold mb-4 gradient-text">
                            <i class="fas fa-play-circle mr-2"></i>${video.title}
                        </h3>
                        
                        <!-- Lecteur vidéo YouTube -->
                        <div class="relative mb-6 bg-black rounded-lg" style="padding-bottom: 56.25%; height: 0;">
                            <iframe 
                                class="absolute top-0 left-0 w-full h-full rounded-lg"
                                src="https://www.youtube.com/embed/${video.youtube_id}?autoplay=1&rel=0"
                                title="${video.title}"
                                frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen>
                            </iframe>
                        </div>
                        
                        <div class="bg-blue-50 rounded-lg p-4 mb-6">
                            <div class="text-2xl mb-2">📺</div>
                            <p class="text-sm text-blue-800">
                                <strong>${video.title}</strong><br>
                                ${video.description || 'Vidéo éducative interactive'}<br>
                                <em>Durée: ${video.duration}</em>
                            </p>
                        </div>
                        
                        <div class="flex gap-3 justify-center">
                            <button class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 btn-bounce" onclick="showVideoEndPrompt('${videoId}', '${subject}', '${video.title}')">
                                <i class="fas fa-check mr-2"></i>J'ai fini de regarder
                            </button>
                            <button class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 btn-bounce" onclick="closeModal()">
                                <i class="fas fa-times mr-2"></i>Fermer
                            </button>
                        </div>
                    </div>
                `);
                
                // Plus de simulation - l'utilisateur clique sur "J'ai fini de regarder" quand il veut
            }
            
            showVideoEndPrompt(videoId, subject, video) {
                this.closeModal();
                const modal = this.createModal(`
                    <div class="text-center max-w-md mx-auto">
                        <div class="mb-6">
                            <div class="text-6xl mb-4">🎉</div>
                            <h3 class="text-2xl font-bold mb-2 text-green-600">Vidéo terminée !</h3>
                            <p class="text-gray-600 mb-4">Félicitations ! Tu as regardé la vidéo :</p>
                            <p class="font-semibold text-lg text-purple-600">${video.title}</p>
                        </div>
                        
                        <div class="bg-gradient-to-r from-yellow-50 to-orange-50 rounded-lg p-6 mb-6 border-2 border-yellow-200">
                            <div class="text-3xl mb-3">❓</div>
                            <h4 class="text-lg font-bold text-orange-800 mb-3">Voulez-vous faire le quiz ?</h4>
                            <p class="text-sm text-gray-700 mb-4">
                                Testez vos connaissances sur cette vidéo et gagnez des pièces !
                            </p>
                            <div class="flex items-center justify-center gap-2 text-yellow-600">
                                <i class="fas fa-coins"></i>
                                <span class="font-bold">+15 pièces par bonne réponse !</span>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <button class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-4 rounded-lg font-bold text-lg transition-all duration-300 btn-bounce transform hover:scale-105" onclick="startVideoQuiz('${videoId}')">
                                <i class="fas fa-play mr-2"></i>Oui, je veux faire le quiz !
                            </button>
                            <button class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 btn-bounce" onclick="showVideos('${subject}')">
                                <i class="fas fa-video mr-2"></i>Voir d'autres vidéos
                            </button>
                            <button class="w-full bg-gradient-to-r from-gray-400 to-gray-500 hover:from-gray-500 hover:to-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 btn-bounce" onclick="closeModal()">
                                <i class="fas fa-times mr-2"></i>Fermer
                            </button>
                        </div>
                    </div>
                `);
            }
            
            startQuiz(subject) {
                const quizzes = this.quizData[subject] || [];
                
                if (quizzes.length === 0) {
                    this.showNotification(`Aucun quiz disponible pour ${this.getSubjectDisplayName(subject)}`);
                    return;
                }
                
                const modal = this.createModal(`
                    <div class="text-center max-w-4xl mx-auto">
                        <div class="mb-6">
                            <h3 class="text-2xl font-bold mb-2 gradient-text">
                                ❓ ${this.getSubjectDisplayName(subject)} - Quiz
                            </h3>
                            <div class="bg-gradient-to-r from-blue-50 to-green-50 rounded-lg p-3 mb-4">
                                <p class="text-sm text-gray-700">
                                    <span class="font-semibold">Classe ${this.selectedClass.toUpperCase()}</span> - 
                                    <span class="text-blue-600 font-medium">${quizzes.length} question${quizzes.length > 1 ? 's' : ''} disponible${quizzes.length > 1 ? 's' : ''}</span>
                                </p>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-semibold mb-4 text-gray-800">🎯 Choisis un quiz à faire :</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-96 overflow-y-auto">
                                ${quizzes.map((quiz, index) => `
                                    <div class="group bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1" onclick="startDirectQuiz('${subject}', ${index})">
                                        <div class="bg-gradient-to-br from-blue-200 to-green-200 p-6 text-center">
                                            <div class="text-4xl mb-3">❓</div>
                                            <div class="bg-white bg-opacity-20 rounded-lg p-2">
                                                <p class="font-bold text-gray-800 text-sm">Question ${index + 1}</p>
                                            </div>
                                        </div>
                                        <div class="p-4">
                                            <h5 class="font-bold text-sm mb-2 text-gray-800 line-clamp-2">${quiz.question}</h5>
                                            <div class="text-xs text-gray-600 mb-3">
                                                <i class="fas fa-clock mr-1"></i>Réponse rapide
                                                <span class="ml-3"><i class="fas fa-coins mr-1 text-yellow-500"></i>+10 pièces</span>
                                            </div>
                                            <div class="flex items-center justify-center">
                                                <div class="bg-gradient-to-r from-blue-500 to-green-500 text-white py-2 px-3 rounded-lg text-xs font-bold flex items-center gap-1">
                                                    <i class="fas fa-play"></i>
                                                    Commencer
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 rounded-lg p-4 mb-6 border-2 border-yellow-200">
                            <div class="flex items-center justify-center gap-2 mb-2">
                                <i class="fas fa-lightbulb text-yellow-500 text-xl"></i>
                                <span class="font-bold text-yellow-700">Astuce</span>
                            </div>
                            <p class="text-sm text-yellow-700">
                                Chaque bonne réponse te rapporte <strong>10 pièces</strong> ! Plus tu réussis, plus tu progresses dans la matière.
                            </p>
                        </div>
                        
                        <div class="border-t pt-4">
                            <div class="flex gap-3 justify-center">
                                <button class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 btn-bounce" onclick="showSubjectModal('${subject}')">
                                    <i class="fas fa-arrow-left mr-2"></i>Retour à la matière
                                </button>
                                <button class="bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 btn-bounce" onclick="closeModal()">
                                    <i class="fas fa-times mr-2"></i>Fermer
                                </button>
                            </div>
                        </div>
                    </div>
                `);
            }
            
            startDirectQuiz(subject, questionIndex) {
                this.closeModal();
                const quizzes = this.quizData[subject] || [];
                
                if (questionIndex >= quizzes.length) {
                    this.showNotification('Question introuvable !');
                    return;
                }
                
                this.currentQuiz = {
                    type: 'direct',
                    subject: subject,
                    questions: [quizzes[questionIndex]], // Une seule question
                    currentQuestion: 0,
                    score: 0,
                    answers: []
                };
                
                this.showDirectQuizQuestion();
            }
            
            showDirectQuizQuestion() {
                const quiz = this.currentQuiz;
                const question = quiz.questions[quiz.currentQuestion];
                
                const modal = this.createModal(`
                    <div class="text-center max-w-2xl mx-auto">
                        <div class="mb-6">
                            <h3 class="text-xl font-bold gradient-text">Quiz : ${this.getSubjectDisplayName(quiz.subject)}</h3>
                            <p class="text-sm text-gray-600">Question ${quiz.currentQuestion + 1} sur ${quiz.questions.length}</p>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 mb-6">
                            <h4 class="text-lg font-bold mb-4 text-gray-800">${question.question}</h4>
                            
                            <div class="grid grid-cols-1 gap-3">
                                ${question.answers.map((answer, index) => `
                                    <button class="quiz-answer bg-white hover:bg-blue-100 border-2 border-gray-200 hover:border-blue-300 p-4 rounded-lg text-left transition-all duration-300 btn-bounce transform hover:scale-105" 
                                            onclick="selectDirectQuizAnswer(${index})" data-index="${index}">
                                        <div class="flex items-center">
                                            <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center font-bold mr-3">
                                                ${String.fromCharCode(65 + index)}
                                            </div>
                                            <span class="font-medium">${answer}</span>
                                        </div>
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button class="bg-gray-500 text-white px-6 py-3 rounded-lg hover:bg-gray-600 btn-bounce" onclick="closeModal()">
                                <i class="fas fa-times mr-2"></i>Annuler
                            </button>
                        </div>
                    </div>
                `);
            }
            
            selectDirectQuizAnswer(selectedIndex) {
                const quiz = this.currentQuiz;
                const question = quiz.questions[quiz.currentQuestion];
                const correct = selectedIndex === question.correct;
                
                if (correct) {
                    quiz.score++;
                }
                
                quiz.answers.push({
                    question: question.question,
                    selectedAnswer: question.answers[selectedIndex],
                    correctAnswer: question.answers[question.correct],
                    correct: correct
                });
                
                this.showDirectQuizResults(correct, question);
            }
            
            showDirectQuizResults(correct, question) {
                const quiz = this.currentQuiz;
                const coinsEarned = correct ? 10 : 0;
                const xpEarned = correct ? 5 : 0;
                
                if (correct) {
                    this.coins += coinsEarned;
                    this.addXP(xpEarned);
                    this.updateCoinAndXpDisplay();
                    
                    // Mise à jour des progrès
                    this.subjects[quiz.subject].progress = Math.min(100, this.subjects[quiz.subject].progress + 5);
                    this.updateProgressBars();
                }
                
                const modal = this.createModal(`
                    <div class="text-center max-w-md mx-auto">
                        <div class="mb-6">
                            <div class="${correct ? 'bg-green-500' : 'bg-red-500'} text-white w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                <i class="fas ${correct ? 'fa-check' : 'fa-times'} text-3xl"></i>
                            </div>
                            <h3 class="text-2xl font-bold mb-2 ${correct ? 'text-green-600' : 'text-red-600'}">
                                ${correct ? 'Excellente réponse !' : 'Pas tout à fait...'}
                            </h3>
                            ${correct ? 
                                `<div class="bg-green-50 rounded-lg p-4 mb-4">
                                    <p class="text-green-800 font-semibold mb-2">+${coinsEarned}💰 +${xpEarned}⭐ gagnés !</p>
                                    <p class="text-sm text-green-700">Continue comme ça, tu progresses bien !</p>
                                </div>` : 
                                `<div class="bg-red-50 rounded-lg p-4 mb-4">
                                    <p class="text-red-800 font-semibold mb-2">La bonne réponse était :</p>
                                    <p class="text-sm text-red-700 font-bold">${question.answers[question.correct]}</p>
                                </div>`
                            }
                        </div>
                        
                        <div class="space-y-3">
                            <button class="w-full bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 btn-bounce" onclick="startQuiz('${quiz.subject}')">
                                <i class="fas fa-redo mr-2"></i>Faire un autre quiz
                            </button>
                            <button class="w-full bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 btn-bounce" onclick="showSubjectModal('${quiz.subject}')">
                                <i class="fas fa-arrow-left mr-2"></i>Retour à la matière
                            </button>
                            <button class="w-full bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-lg font-medium transition-all duration-300 btn-bounce" onclick="closeModal()">
                                <i class="fas fa-times mr-2"></i>Fermer
                            </button>
                        </div>
                    </div>
                `);
                
                // Sauvegarder les progrès
                this.saveGameData();
                
                // Réinitialiser le quiz
                this.currentQuiz = null;
            }

            startVideoQuiz(videoId) {
                const questions = this.videoQuizzes[videoId] || [];
                if (questions.length === 0) {
                    this.showNotification('Aucun quiz disponible pour cette vidéo !');
                    return;
                }
                
                this.currentQuiz = {
                    type: 'video',
                    videoId: videoId,
                    subject: this.currentVideo.subject,
                    questions: [...questions],
                    currentQuestion: 0,
                    score: 0,
                    answers: []
                };
                
                this.showVideoQuizQuestion();
            }

            showVideoQuizQuestion() {
                const quiz = this.currentQuiz;
                const question = quiz.questions[quiz.currentQuestion];
                const progress = ((quiz.currentQuestion + 1) / quiz.questions.length) * 100;
                
                let questionHTML = '';
                
                if (question.type === 'qcm') {
                    questionHTML = `
                        <div class="grid grid-cols-1 gap-3">
                            ${question.answers.map((answer, index) => `
                                <button class="quiz-answer bg-gray-100 hover:bg-blue-100 p-4 rounded-lg text-left transition-colors btn-bounce" 
                                        onclick="selectVideoAnswer(${index})" data-index="${index}">
                                    ${String.fromCharCode(65 + index)}) ${answer}
                                </button>
                            `).join('')}
                        </div>
                    `;
                } else if (question.type === 'truefalse') {
                    questionHTML = `
                        <div class="grid grid-cols-2 gap-4">
                            <button class="quiz-answer bg-green-100 hover:bg-green-200 p-6 rounded-lg transition-colors btn-bounce" 
                                    onclick="selectVideoAnswer(true)">
                                ✅ VRAI
                            </button>
                            <button class="quiz-answer bg-red-100 hover:bg-red-200 p-6 rounded-lg transition-colors btn-bounce" 
                                    onclick="selectVideoAnswer(false)">
                                ❌ FAUX
                            </button>
                        </div>
                    `;
                } else if (question.type === 'short') {
                    questionHTML = `
                        <div class="text-center">
                            <input type="text" id="short-answer" placeholder="Ta réponse..." 
                                   class="border-2 border-gray-300 rounded-lg px-4 py-3 text-center text-lg w-64 mb-4">
                            <br>
                            <button class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 btn-bounce" 
                                    onclick="selectVideoAnswer(document.getElementById('short-answer').value)">
                                Valider ma réponse
                            </button>
                        </div>
                    `;
                }
                
                const modal = this.createModal(`
                    <div class="text-center">
                        <div class="mb-4">
                            <h3 class="text-xl font-bold gradient-text">Quiz : ${this.currentVideo.title}</h3>
                            <p class="text-sm text-gray-600">Question ${quiz.currentQuestion + 1} sur ${quiz.questions.length}</p>
                            <div class="progress-bar mt-2">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <h4 class="text-lg font-bold mb-4">${question.question}</h4>
                            ${questionHTML}
                        </div>
                        
                        <div class="flex justify-between text-sm text-gray-600">
                            <div>Score: <span class="font-bold text-green-600">${quiz.score}/${quiz.currentQuestion}</span></div>
                            <div><i class="fas fa-coins text-yellow-500"></i> +${quiz.questions.length * 15} pièces max</div>
                        </div>
                    </div>
                `);
            }

            selectVideoAnswer(selectedAnswer) {
                const quiz = this.currentQuiz;
                const question = quiz.questions[quiz.currentQuestion];
                
                // Protection contre les clics multiples
                if (quiz.answerProcessing || quiz.answers.find(a => a.question === quiz.currentQuestion)) {
                    return; // Empêcher les réponses multiples pour la même question
                }
                quiz.answerProcessing = true;
                
                let correct = false;
                
                if (question.type === 'qcm') {
                    correct = selectedAnswer === question.correct;
                } else if (question.type === 'truefalse') {
                    correct = selectedAnswer === question.correct;
                } else if (question.type === 'short') {
                    correct = selectedAnswer.toString().toLowerCase().trim() === question.correct.toString().toLowerCase().trim();
                }
                
                quiz.answers.push({
                    question: quiz.currentQuestion,
                    selected: selectedAnswer,
                    correct: question.correct,
                    isCorrect: correct
                });
                
                if (correct) {
                    quiz.score++;
                    // Récompense en pièces et XP pour bonne réponse
                    const coinsEarned = question.coins || 5; // 5 pièces par défaut si pas défini
                    const xpEarned = Math.floor(coinsEarned / 2) + 2; // XP basé sur les pièces + bonus
                    this.coins += coinsEarned;
                    this.addXP(xpEarned);
                    quiz.totalCoinsEarned = (quiz.totalCoinsEarned || 0) + coinsEarned;
                    quiz.totalXpEarned = (quiz.totalXpEarned || 0) + xpEarned;
                    this.showNotification(`+${coinsEarned}💰 +${xpEarned}⭐ ! 🎉`);
                    
                    // Progression des quêtes pour réponses correctes
                    this.updateQuestProgress('correct_answers', quiz.subject);
                    
                    this.saveGameData(); // Sauvegarder immédiatement
                }
                
                this.showVideoAnswerFeedback(correct, question);
                
                // Remettre le flag à false après traitement
                setTimeout(() => {
                    quiz.answerProcessing = false;
                }, 500);
            }

            showVideoAnswerFeedback(correct, question) {
                const quiz = this.currentQuiz;
                const feedbackColor = correct ? 'bg-green-500' : 'bg-red-500';
                const feedbackIcon = correct ? 'fa-check' : 'fa-times';
                let feedbackText = correct ? 'Excellente réponse !' : 'Pas tout à fait...';
                
                if (!correct && question.type === 'qcm') {
                    feedbackText += ` La bonne réponse était: ${question.answers[question.correct]}`;
                } else if (!correct && question.type === 'short') {
                    feedbackText += ` La bonne réponse était: ${question.correct}`;
                }
                
                const modal = this.createModal(`
                    <div class="text-center">
                        <div class="${feedbackColor} text-white w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas ${feedbackIcon} text-2xl"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-4">${feedbackText}</h3>
                        ${correct ? '<p class="text-green-600 mb-4">+15 pièces !</p>' : ''}
                        <button class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 btn-bounce" 
                                onclick="nextVideoQuestion()">
                            ${quiz.currentQuestion + 1 < quiz.questions.length ? 'Question suivante' : 'Voir les résultats'}
                        </button>
                    </div>
                `);
                
                if (correct) {
                    this.coins += 15;
                    this.updateCoinAndXpDisplay();
                    this.updateQuestProgress('earn_coins', 'all', 15);
                }
            }

            nextVideoQuestion() {
                this.closeModal();
                this.currentQuiz.currentQuestion++;
                
                if (this.currentQuiz.currentQuestion < this.currentQuiz.questions.length) {
                    this.showVideoQuizQuestion();
                } else {
                    this.showVideoQuizResults();
                }
            }

            showVideoQuizResults() {
                const quiz = this.currentQuiz;
                const percentage = Math.round((quiz.score / quiz.questions.length) * 100);
                const bonusCoins = percentage === 100 ? 50 : 20; // Bonus pour 100%
                const totalCoins = quiz.score * 15 + bonusCoins;
                
                // Mise à jour des progrès
                this.subjects[quiz.subject].progress = Math.min(100, this.subjects[quiz.subject].progress + (percentage / 4));
                const newStars = Math.ceil(this.subjects[quiz.subject].progress / 20);
                this.subjects[quiz.subject].stars = Math.max(this.subjects[quiz.subject].stars, newStars);
                
                this.coins += bonusCoins;
                this.updateCoinAndXpDisplay();
                
                // Progression des quêtes
                this.updateQuestProgress('quiz_complete', quiz.subject);
                if (percentage === 100) {
                    this.updateQuestProgress('perfect_quizzes', 'all');
                }
                this.updateQuestProgress('earn_coins', 'all', bonusCoins + (quiz.totalCoinsEarned || 0));
                
                let message = '';
                if (percentage === 100) message = 'PARFAIT ! Tu as tout compris ! 🏆';
                else if (percentage >= 75) message = 'Très bien ! Continue comme ça ! 🌟';
                else if (percentage >= 50) message = 'Bon travail ! Tu progresses ! 👍';
                else message = 'Continue à t\'entraîner ! 💪';
                
                const modal = this.createModal(`
                    <div class="text-center">
                        <h3 class="text-2xl font-bold mb-4 gradient-text">Quiz Vidéo Terminé !</h3>
                        <div class="mb-4">
                            <div class="text-6xl mb-2">${percentage === 100 ? '🏆' : percentage >= 75 ? '🌟' : percentage >= 50 ? '👍' : '💪'}</div>
                            <p class="text-lg font-bold">${message}</p>
                        </div>
                        
                        <div class="bg-gray-100 rounded-lg p-4 mb-4">
                            <div class="grid grid-cols-3 gap-4 text-center">
                                <div>
                                    <div class="text-2xl font-bold text-green-600">${quiz.score}/${quiz.questions.length}</div>
                                    <div class="text-sm text-gray-600">Bonnes réponses</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-blue-600">${percentage}%</div>
                                    <div class="text-sm text-gray-600">Score</div>
                                </div>
                                <div>
                                    <div class="text-2xl font-bold text-yellow-600">+${totalCoins}</div>
                                    <div class="text-sm text-gray-600">Pièces</div>
                                </div>
                            </div>
                        </div>
                        
                        ${percentage === 100 ? '<div class="bg-yellow-100 rounded-lg p-3 mb-4"><p class="text-yellow-800 font-bold">🎉 Bonus 100% : +500 pièces supplémentaires !</p></div>' : ''}
                        
                        <div class="text-center">
                            <button class="bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-8 py-4 rounded-lg font-bold text-lg transition-all duration-300 btn-bounce transform hover:scale-105" 
                                    onclick="finishVideoQuiz()">
                                <i class="fas fa-trophy mr-2"></i>Terminer et réclamer mes gains !
                            </button>
                        </div>
                    </div>
                `);
            }

            finishVideoQuiz() {
                this.closeModal();
                this.currentQuiz = null;
                this.currentVideo = null;
                this.showNotification('Bravo ! Continue à apprendre avec les vidéos ! 🎓');
                this.updateStarsOnCards();
            }

            selectClass(className) {
                this.selectedClass = className;
                
                // Mettre à jour l'affichage de la classe sélectionnée
                document.getElementById('selectedClass').textContent = className.toUpperCase();
                
                // Mettre à jour les boutons de classe
                document.querySelectorAll('.class-btn').forEach(btn => {
                    btn.classList.remove('bg-blue-100', 'hover:bg-blue-200', 'text-blue-800');
                    btn.classList.add('bg-gray-100', 'hover:bg-gray-200', 'text-gray-600');
                });
                
                // Activer le bouton sélectionné
                const selectedBtn = document.querySelector(`[data-class="${className}"]`);
                if (selectedBtn) {
                    selectedBtn.classList.remove('bg-gray-100', 'hover:bg-gray-200', 'text-gray-600');
                    selectedBtn.classList.add('bg-blue-100', 'hover:bg-blue-200', 'text-blue-800');
                }
                
                this.showNotification(`Classe ${className.toUpperCase()} sélectionnée !`);
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-info-circle mr-2"></i>
                        ${message}
                    </div>
                `;
                document.body.appendChild(notification);
                
                // Show notification
                setTimeout(() => notification.classList.add('show'), 100);
                
                // Hide notification
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            }

            getSubjectDisplayName(subject) {
                const names = {
                    math: 'Mathématiques',
                    french: 'Français',
                    science: 'Sciences',
                    histgeo: 'Histoire-Géographie',
                    history: 'Histoire',
                    english: 'Anglais',
                    geography: 'Géographie'
                };
                return names[subject] || subject;
            }

            generateStars(count) {
                let stars = '';
                for (let i = 1; i <= 5; i++) {
                    if (i <= count) {
                        stars += '<i class="fas fa-star text-yellow-400 star"></i>';
                    } else {
                        stars += '<i class="far fa-star text-gray-300 star"></i>';
                    }
                }
                return `<div class="star-rating flex">${stars}</div>`;
            }
        }

        // Fonctions globales
        function selectClass(className) {
            if (window.platform) window.platform.selectClass(className);
        }
        
        function openShop() {
            if (window.platform) window.platform.openShop();
        }
        
        function openInventory() {
            if (window.platform) window.platform.openInventory();
        }

        function buyMysteryBox() {
            if (window.platform) window.platform.buyMysteryBox();
        }

        function selectCharacterFromInventory(character) {
            if (window.platform) window.platform.selectCharacterFromInventory(character);
        }

        function closeCharacterUnlockPage() {
            if (window.platform) window.platform.closeCharacterUnlockPage();
        }

        function openQuests() {
            if (window.platform) window.platform.openQuests();
        }

        function startQuest(questIndex) {
            if (window.platform) window.platform.startQuest(questIndex);
        }

        function claimTimelineReward(milestoneIndex) {
            if (window.platform) window.platform.claimTimelineReward(milestoneIndex);
        }

        function closeCinematic() {
            if (window.platform) window.platform.closeCinematic();
        }
        
        function openProfileSetup() {
            if (window.platform) window.platform.openProfileSetup();
        }
        
        function saveUserProfile() {
            if (window.platform) window.platform.saveUserProfile();
        }
        
        function editProfile() {
            if (window.platform) window.platform.editProfile();
        }
        
        // Fonction pour le menu mobile
        function toggleMobileMenu() {
            const overlay = document.getElementById('mobileMenuOverlay');
            const hamburgerIcon = document.getElementById('hamburgerIcon');
            const closeIcon = document.getElementById('closeIcon');
            
            if (overlay.classList.contains('menu-open')) {
                // Fermer le menu
                overlay.classList.remove('menu-open');
                hamburgerIcon.classList.remove('hidden');
                closeIcon.classList.add('hidden');
                document.body.style.overflow = ''; // Restaurer le scroll
            } else {
                // Ouvrir le menu
                overlay.classList.add('menu-open');
                hamburgerIcon.classList.add('hidden');
                closeIcon.classList.remove('hidden');
                document.body.style.overflow = 'hidden'; // Bloquer le scroll
                
                // Mettre à jour les stats utilisateur dans le menu
                updateMobileMenuStats();
            }
        }
        
        function updateMobileMenuStats() {
            if (window.platform) {
                const mobileUserName = document.getElementById('mobileUserName');
                const mobileCoinCount = document.getElementById('mobileCoinCount');
                const mobileXpCount = document.getElementById('mobileXpCount');
                
                if (mobileUserName) mobileUserName.textContent = window.platform.studentName || 'Visiteur';
                if (mobileCoinCount) mobileCoinCount.textContent = window.platform.coins || '0';
                if (mobileXpCount) mobileXpCount.textContent = `⭐${window.platform.xp || 0} 🏆${window.platform.level || 1}`;
            }
        }
        
        function showVideos(subject) {
            if (window.platform) window.platform.showVideos(subject);
        }
        
        function startQuiz(subject) {
            if (window.platform) window.platform.startQuiz(subject);
        }
        
        function startDirectQuiz(subject, questionIndex) {
            if (window.platform) window.platform.startDirectQuiz(subject, questionIndex);
        }
        
        function selectDirectQuizAnswer(selectedIndex) {
            if (window.platform) window.platform.selectDirectQuizAnswer(selectedIndex);
        }
        
        function buyCharacter(character, cost) {
            if (window.platform) window.platform.buyCharacter(character, cost);
        }
        
        function watchVideo(videoId, subject) {
            if (window.platform) window.platform.watchVideo(videoId, subject);
        }
        
        function showVideoEndPrompt(videoId, subject, title) {
            if (window.platform) window.platform.showVideoEndPrompt(videoId, subject, {title: title});
        }
        
        function showSubjectModal(subject) {
            if (window.platform) window.platform.showSubjectModal(subject);
        }
        
        function startVideoQuiz(videoId) {
            if (window.platform) window.platform.startVideoQuiz(videoId);
        }
        
        function selectVideoAnswer(answer) {
            if (window.platform) window.platform.selectVideoAnswer(answer);
        }
        
        function nextVideoQuestion() {
            if (window.platform) window.platform.nextVideoQuestion();
        }
        
        function finishVideoQuiz() {
            if (window.platform) window.platform.finishVideoQuiz();
        }
        
        function selectQuizAnswer(index) {
            if (window.platform) window.platform.selectQuizAnswer(index);
        }
        
        function nextQuizQuestion() {
            if (window.platform) window.platform.nextQuizQuestion();
        }
        
        function finishQuiz() {
            if (window.platform) window.platform.finishQuiz();
        }
        
        function closeModal() {
            if (window.platform) window.platform.closeModal();
        }

        // Initialize the platform when DOM is loaded
        window.platform = null;
        document.addEventListener('DOMContentLoaded', function() {
            window.platform = new LearningPlatform();
            console.log('✅ Platform chargé avec succès!');
        });
        
        // Fallback de sécurité (au cas où)
        window.addEventListener('error', function() {
            if (!window.platform) {
                console.log('🔄 Chargement du fallback...');
                window.platform = {
                    coins: 0,
                    xp: 0,
                    level: 1,
                    
                    updateDisplay: function() {
                        const coinCounter = document.getElementById('coinCounter');
                        const xpDisplay = document.getElementById('xpDisplay');
                        if (coinCounter) coinCounter.textContent = this.coins;
                        if (xpDisplay) xpDisplay.textContent = `⭐${this.xp} 🏆${this.level}`;
                    },
                    
                    addCoins: function(amount) {
                        this.coins += amount;
                        this.updateDisplay();
                    },
                    
                    addXP: function(amount) {
                        this.xp += amount;
                        const newLevel = Math.floor(this.xp / 100) + 1;
                        if (newLevel > this.level) {
                            this.level = newLevel;
                            this.addCoins(50);
                            alert(`🎉 NIVEAU SUPÉRIEUR! Tu es maintenant 🏆${this.level}! +50 pièces bonus!`);
                        }
                        this.updateDisplay();
                    },
                    
                    createModal: function(content) {
                        const modal = document.createElement('div');
                        modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                        modal.innerHTML = `
                            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 p-6 max-h-90vh overflow-y-auto">
                                ${content}
                            </div>
                        `;
                        document.body.appendChild(modal);
                        modal.addEventListener('click', (e) => {
                            if (e.target === modal) modal.remove();
                        });
                        return modal;
                    },
                    
                    openShop: function() {
                        this.createModal(`
                            <h2 class="text-2xl font-bold mb-4">🏪 Boutique</h2>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div class="border rounded-lg p-4 text-center">
                                    <div class="text-4xl mb-2">🎁</div>
                                    <h3 class="font-bold">Boîte Mystère</h3>
                                    <p class="text-sm text-gray-600">50 pièces</p>
                                    <button onclick="window.platform.buyMysteryBox()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded">Acheter</button>
                                </div>
                                <div class="border rounded-lg p-4 text-center">
                                    <div class="text-4xl mb-2">🐲</div>
                                    <h3 class="font-bold">Dragon Rare</h3>
                                    <p class="text-sm text-gray-600">200 pièces</p>
                                    <button onclick="alert('Pas assez de pièces!')" class="mt-2 bg-gray-400 text-white px-4 py-2 rounded">Acheter</button>
                                </div>
                            </div>
                            <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded">Fermer</button>
                        `);
                    },
                    
                    buyMysteryBox: function() {
                        if (this.coins >= 50) {
                            this.coins -= 50;
                            this.addXP(10);
                            const characters = ['🐁', '🐸', '🐟', '🐦', '🐰', '🐢'];
                            const randomChar = characters[Math.floor(Math.random() * characters.length)];
                            alert(`🎉 Tu as reçu: ${randomChar} +10 XP!`);
                            this.updateDisplay();
                        } else {
                            alert('Pas assez de pièces! Il te faut 50 pièces.');
                        }
                    },
                    
                    openInventory: function() {
                        this.createModal(`
                            <h2 class="text-2xl font-bold mb-4">🎒 Inventaire</h2>
                            <div class="grid grid-cols-4 gap-4 mb-4">
                                <div class="border rounded-lg p-4 text-center bg-blue-50">
                                    <div class="text-4xl mb-2">🤖</div>
                                    <p class="text-sm">Robot</p>
                                </div>
                                <div class="border rounded-lg p-4 text-center">
                                    <div class="text-4xl mb-2">🐁</div>
                                    <p class="text-sm">Souris</p>
                                </div>
                            </div>
                            <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded">Fermer</button>
                        `);
                    },
                    
                    openQuests: function() {
                        this.createModal(`
                            <h2 class="text-2xl font-bold mb-4">🏹 Quêtes</h2>
                            <div class="space-y-4 mb-4">
                                <div class="border rounded-lg p-4 bg-green-50">
                                    <h3 class="font-bold">🎯 Première Réponse</h3>
                                    <p class="text-sm text-gray-600">Réponds correctement à une question</p>
                                    <div class="mt-2">
                                        <span class="text-sm bg-green-200 px-2 py-1 rounded">Terminée!</span>
                                        <span class="ml-2">💰25 ⭐10</span>
                                    </div>
                                </div>
                                <div class="border rounded-lg p-4">
                                    <h3 class="font-bold">📚 Étudiant Assidu</h3>
                                    <p class="text-sm text-gray-600">Termine 5 leçons</p>
                                    <div class="mt-2">
                                        <div class="bg-gray-200 rounded-full h-2 mb-1">
                                            <div class="bg-blue-500 h-2 rounded-full" style="width: 40%"></div>
                                        </div>
                                        <span class="text-sm">2/5 progrès</span>
                                    </div>
                                </div>
                            </div>
                            <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded">Fermer</button>
                        `);
                    },
                    
                    openProfileSetup: function() {
                        this.createModal(`
                            <h2 class="text-2xl font-bold mb-4">👤 Mon Profil</h2>
                            <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 mb-6">
                                <div class="text-6xl mb-4">🎓</div>
                                <h4 class="text-xl font-bold text-gray-800 mb-2">Visiteur</h4>
                                <p class="text-gray-600 mb-4">Classe : CP</p>
                                <div class="flex items-center justify-center gap-4">
                                    <div class="flex items-center gap-2 text-yellow-600">
                                        <span class="font-bold">💰${this.coins}</span>
                                    </div>
                                    <div class="flex items-center gap-2 text-blue-600">
                                        <span class="font-bold">⭐${this.xp} 🏆${this.level}</span>
                                    </div>
                                </div>
                            </div>
                            <button onclick="this.closest('.fixed').remove()" class="bg-gray-500 text-white px-4 py-2 rounded">Fermer</button>
                        `);
                    },
                    
                    selectClass: function(className) {
                        console.log('Classe sélectionnée:', className);
                        document.querySelectorAll('.class-btn').forEach(btn => {
                            btn.classList.remove('bg-blue-500', 'text-white');
                            btn.classList.add('bg-gray-100', 'text-gray-600');
                        });
                        const selectedBtn = document.querySelector(`[data-class="${className}"]`);
                        if (selectedBtn) {
                            selectedBtn.classList.add('bg-blue-500', 'text-white');
                            selectedBtn.classList.remove('bg-gray-100', 'text-gray-600');
                        }
                    }
                };
                // Initialiser l'affichage
                setTimeout(() => window.platform.updateDisplay(), 100);
            }
        });
    </script>
</body>
</html>